<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <title>C++20 Calender and timezone library - roki.log</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet" />
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" />
    <link href="../../../../../theme/style.css" rel="stylesheet" />
    <link rel="shortcut icon" href="../../../../../favicon.ico" type="image/vnd.microsoft.icon">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/solid.css" integrity="sha384-TbilV5Lbhlwdyc4RuIV/JhD8NR+BfMrvz4BL5QFa2we1hQu6wvREr3v6XSRfCTRp" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/brands.css" integrity="sha384-7xAnn7Zm3QC1jFjVc1A6v/toepoG3JXboQYzbM0jrPzou9OFXm/fY6Z/XiIebl/k" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/fontawesome.css" integrity="sha384-ozJwkrqb90Oa3ZNb+yKFW2lToAWYdTiF1vt8JiH5ptTGHTGcN7qdoR1F95e0kYyG" crossorigin="anonymous">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script src="../../../../../theme/js/css_browser_selector.js" type="text/javascript"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="roki" />
        <link href="../../../../../theme/tipuesearch/tipuesearch.css" rel="stylesheet">
        <link href="../../../../../theme/typogrify.css" rel="stylesheet">
    <link href="https://falgon.github.io/roki.log/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="roki.log Full Atom Feed" />
    <link href="https://falgon.github.io/roki.log/feeds/cpp.rss.xml" type="application/atom+xml" rel="alternate" title="roki.log Categories Atom Feed" />

  </head>
  <body id="index" class="archive" style="font-family: '游明朝', 'Yu Mincho' , '游明朝体' , 'YuMincho' , 'ヒラギノ明朝 Pro W3' , 'Hiragino Mincho Pro' , 'HiraMinProN-W3', 'HGS明朝E' , 'ＭＳ Ｐ明朝' , 'MS PMincho', serif;">
    <!--[if lt IE 7]>
        <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->

<div class="modal fade" id="myModal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">👋New blog information / ブログ移転のお知らせ</h4>
      </div>
      <div class="modal-body">
      This blog has been moved to <a href="https://roki.dev/roki.log">new one (roki.dev/roki.log)</a> for 
      serving you better view. This blog is no longer updated.
      Thank you for migrating and re-registering your bookmarks.
      <hr >
      このブログは, 
      <a href="https://roki.dev/roki.log">新ブログ (roki.dev/roki.log)</a> 
      に移転しました。このページの今後の更新はありませんが,
      移行用, 記録用に残されています。
      もし宜しければ, 移行, またはブックマークの再登録をよろしくお願いいたします。
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-dismiss="modal">閉じる</button>
       </div>
    </div>
  </div>
</div>

    <nav class="navbar navbar-default" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../../../../..">roki.log</a>
        </div>
        <div class="collapse navbar-collapse navbar-right">
          <ul class="nav navbar-nav">
            <li>
                    <a href="../../../../../pages/about"><i class="fas fa-info-circle" style="margin-right: 4px;"></i>About</a>
            </li>
            <li>
            </li>
            
            <li><a href="../../../../../tags.html"><i class="fas fa-tags" style="margin-right: 4px;"></i>Tags</a></li>
            <li><span>
                <form class="navbar-search" action="https://falgon.github.io/roki.log/search.html">
                    <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input" required>
                </form></span>
            </li>
          </ul>
        </div>
        <!-- /.navbar-collapse -->
      </div>
    </nav>
    <div class="container">
    <section id="content" class="article content">
      <header>
        <h2 class="entry-title">
          C++20 Calender and timezone&nbsp;library
        </h2>
        
        <div class="text-muted">月 26 3月 2018</div>
      </header>
<!-- .entry-content -->
      <div class="entry-content">
        <p><strong>[<i>2018/4/16 追記</i>:</strong> 本エントリは, 元々 <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2018/p0355r5.html"><span class="caps">P0355R5</span></a> を参考にまとめを行った記事であるが, その後 <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2018/p0355r7.html"><span class="caps">P0355R7</span></a>&nbsp;で</p>
<ul>
<li><code>sun</code>といった曜日を表すリテラルが全て<code>Sunday</code>, <code>may</code>といった月を表すリテラルが全て<code>May</code>といった形式に変更され, またこれらと<code>std::chrono::last_spec</code>型の<code>last</code><sup id="fnref-12"><a class="footnote-ref" href="#fn-12">12</a></sup>が<code>std::literals::chrono_literals</code>名前空間下から<code>std::chrono</code>名前空間下に移動された.</li>
<li><code>system_clock::to_time_t</code>と<code>system_clock::from_time_t</code>を Deprecated としていたが, Deprecated&nbsp;でなくなった.</li>
</ul>
<p>といった他に, 細かい文面の改修や, <code>constexpr</code>がつけられるなどの変更が加えられたため, 本エントリにおいても, それに従い該当箇所を改変している(差分を示すことも考えたが, ただ見難くなるように感じたため, そのようなことはしなかった). これらの変更には対応したつもりだが, 細かい厳密な記述に関しては, やはり P0355 の最新リビジョンを追って確かめてほしい(そして, 間違った箇所があれば指摘くださると嬉しい).
<strong><i>&#8212; 追記ここまで</i>]</strong></p>
<h3>要旨</h3>
<p>先週, 米国フロリダ州ジャクソンビルで <span class="caps">ISO</span> C++ 委員会によって, C++技術仕様(<span class="caps">TS</span>, 実験的機能ブランチ) と次の国際標準(<span class="caps">IS</span>) C++20 に関する作業が行われた.
同会議で <a href="https://www.reddit.com/r/cpp/comments/854mu9/2018_jacksonville_iso_c_committee_reddit_trip/">Reddit で紹介されているように</a>,
C++20 にいくつかの機能が追加された. そのうちの 1 つである, <a href="https://wg21.link/P0355">Calender and timezone library</a> に関する新機能,&nbsp;概要のメモ.</p>
<ul>
<li>全機能の網羅性を主軸としたエントリではない(が,&nbsp;独断と偏見により重要に感じた内容は結果的に網羅してしまっている部分もある)ため注意</li>
<li>以下, 特に断らない限り, 全てのコード片において<code>using namespace std::chrono;</code>, <code>using namespace std::chrono_literals;</code>がされているとする.</li>
<li>以下, 特に断らない限り, 各コードブロック以外で言及される<code>内容</code>といった記述については, 名前空間 <code>std::chrono</code>を省略する.</li>
</ul>
<h3>設計</h3>
<p>以下の内容が追加される.</p>
<ul>
<li><code>&lt;chrono&gt;</code>に対するカレンダーおよびタイムゾーンライブラリをサポートするための最小限の拡張</li>
<li>Proleptic Gregorian calendar(civil&nbsp;calendar)</li>
<li><a href="http://www.iana.org/time-zones"><span class="caps">IANA</span> Time Zone Database</a>&nbsp;を基にしたタイムゾーンライブラリ</li>
<li>分数秒, タイムゾーンの略語, <span class="caps">UTC</span> オフセットの完全サポートおよび<code>strftime</code>のようなフォーマッティング機能</li>
<li><a href="http://www.iana.org/time-zones"><span class="caps">IANA</span> Time Zone Database</a> でサポートされている,&nbsp;閏秒を計算するための複数のクロック</li>
</ul>
<h3>カレンダー</h3>
<p>本ライブラリ機能によって, 例えば 2016&nbsp;年を次のように表現することができる.</p>
<div class="highlight"><pre><span></span><span class="k">auto</span> <span class="n">y</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">year</span><span class="p">{</span><span class="mi">2016</span><span class="p">};</span>
<span class="k">auto</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">2016</span><span class="n">y</span><span class="p">;</span>
</pre></div>


<p>このとき, <code>year</code>は <i>partial-calendar-type (部分カレンダー型)</i> である.
他の部分カレンダー型と組み合わせることで, <code>year_month_day</code>などの <i>full-calendar-type (フルカレンダー型)</i> を生成することができる.
フルカレンダー型は, 1 日の制度を持つタイムポイントであり, 部分カレンダー型である<code>year</code>, <code>month</code>, <code>day</code> で構成される.
これらから<code>year_month_day</code>が構築されると, 内部で計算は一切起きず, 唯一起きることは, <code>year_month_day</code> が内部でそれらを格納するということだけである.</p>
<div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">year_month_day</span> <span class="n">ymd1</span><span class="p">{</span><span class="mi">2016</span><span class="n">y</span><span class="p">,</span> <span class="n">month</span><span class="p">{</span><span class="mi">5</span><span class="p">},</span> <span class="n">day</span><span class="p">{</span><span class="mi">29</span><span class="p">}};</span>
</pre></div>


<p>この場合, すべての入力がコンパイル時定数であるので, <code>constexpr</code> にすることができる. さらに, <code>operator/</code>がオーバーロードされているため,&nbsp;従来の日付の構文が利用できる.</p>
<div class="highlight"><pre><span></span><span class="k">constexpr</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">year_month_day</span> <span class="n">ymd1</span><span class="p">{</span><span class="mi">2016</span><span class="n">y</span><span class="p">,</span> <span class="n">month</span><span class="p">{</span><span class="mi">5</span><span class="p">},</span> <span class="n">day</span><span class="p">{</span><span class="mi">29</span><span class="p">}};</span>
<span class="k">constexpr</span> <span class="k">auto</span> <span class="n">ymd2</span> <span class="o">=</span> <span class="mi">2016</span><span class="n">y</span><span class="o">/</span><span class="n">May</span><span class="o">/</span><span class="mi">29</span><span class="n">d</span><span class="p">;</span>
<span class="k">constexpr</span> <span class="k">auto</span> <span class="n">ymd3</span> <span class="o">=</span> <span class="n">May</span><span class="o">/</span><span class="mi">29</span><span class="n">d</span><span class="o">/</span><span class="mi">2016</span><span class="n">y</span><span class="p">;</span>
<span class="k">constexpr</span> <span class="k">auto</span> <span class="n">ymd4</span> <span class="o">=</span> <span class="mi">29</span><span class="n">d</span><span class="o">/</span><span class="n">May</span><span class="o">/</span><span class="mi">2016</span><span class="n">y</span><span class="p">;</span>
<span class="k">static_assert</span><span class="p">(</span><span class="n">ymd1</span> <span class="o">==</span> <span class="n">ymd2</span><span class="p">);</span>
<span class="k">static_assert</span><span class="p">(</span><span class="n">ymd2</span> <span class="o">==</span> <span class="n">ymd3</span><span class="p">);</span>
<span class="k">static_assert</span><span class="p">(</span><span class="n">ymd3</span> <span class="o">==</span> <span class="n">ymd4</span><span class="p">);</span>
<span class="k">static_assert</span><span class="p">(</span><span class="n">ymd1</span><span class="p">.</span><span class="n">year</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2016</span><span class="n">y</span><span class="p">);</span>
<span class="k">static_assert</span><span class="p">(</span><span class="n">ymd1</span><span class="p">.</span><span class="n">month</span><span class="p">()</span> <span class="o">==</span> <span class="n">May</span><span class="p">);</span>
<span class="k">static_assert</span><span class="p">(</span><span class="n">ymd1</span><span class="p">.</span><span class="n">day</span><span class="p">()</span> <span class="o">==</span> <span class="mi">29</span><span class="n">d</span><span class="p">);</span>
</pre></div>


<p>ここで, <code>May</code>は月を表現する<code>month</code>型のオブジェクトであり, 他に<code>Jan</code>, <code>Feb</code>, <code>Mar</code>, <code>Apr</code>, <code>Jun</code>, <code>Jul</code>, <code>Aug</code>, <code>Sep</code>, <code>Oct</code>, <code>Nov</code>, <code>Dec</code>が,
<em onclick="obj=document.getElementById('openmonth').style; obj.display=(obj.display=='none')?'block':'none';">
<a style="font-style: normal; cursor:pointer;">次のように定義される(クリックで展開).</a>
</em>
<div id="openmonth" style="display:none;clear:both;"></p>
<div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span> <span class="p">{</span>

<span class="kr">inline</span> <span class="k">constexpr</span> <span class="n">chrono</span><span class="o">::</span><span class="n">month</span> <span class="n">January</span><span class="p">{</span><span class="mi">1</span><span class="p">};</span>
<span class="kr">inline</span> <span class="k">constexpr</span> <span class="n">chrono</span><span class="o">::</span><span class="n">month</span> <span class="n">February</span><span class="p">{</span><span class="mi">2</span><span class="p">};</span>
<span class="kr">inline</span> <span class="k">constexpr</span> <span class="n">chrono</span><span class="o">::</span><span class="n">month</span> <span class="n">March</span><span class="p">{</span><span class="mi">3</span><span class="p">};</span>
<span class="kr">inline</span> <span class="k">constexpr</span> <span class="n">chrono</span><span class="o">::</span><span class="n">month</span> <span class="n">April</span><span class="p">{</span><span class="mi">4</span><span class="p">};</span>
<span class="kr">inline</span> <span class="k">constexpr</span> <span class="n">chrono</span><span class="o">::</span><span class="n">month</span> <span class="n">May</span><span class="p">{</span><span class="mi">5</span><span class="p">};</span>
<span class="kr">inline</span> <span class="k">constexpr</span> <span class="n">chrono</span><span class="o">::</span><span class="n">month</span> <span class="n">June</span><span class="p">{</span><span class="mi">6</span><span class="p">};</span>
<span class="kr">inline</span> <span class="k">constexpr</span> <span class="n">chrono</span><span class="o">::</span><span class="n">month</span> <span class="n">July</span><span class="p">{</span><span class="mi">7</span><span class="p">};</span>
<span class="kr">inline</span> <span class="k">constexpr</span> <span class="n">chrono</span><span class="o">::</span><span class="n">month</span> <span class="n">August</span><span class="p">{</span><span class="mi">8</span><span class="p">};</span>
<span class="kr">inline</span> <span class="k">constexpr</span> <span class="n">chrono</span><span class="o">::</span><span class="n">month</span> <span class="n">September</span><span class="p">{</span><span class="mi">9</span><span class="p">};</span>
<span class="kr">inline</span> <span class="k">constexpr</span> <span class="n">chrono</span><span class="o">::</span><span class="n">month</span> <span class="n">October</span><span class="p">{</span><span class="mi">10</span><span class="p">};</span>
<span class="kr">inline</span> <span class="k">constexpr</span> <span class="n">chrono</span><span class="o">::</span><span class="n">month</span> <span class="n">November</span><span class="p">{</span><span class="mi">11</span><span class="p">};</span>
<span class="kr">inline</span> <span class="k">constexpr</span> <span class="n">chrono</span><span class="o">::</span><span class="n">month</span> <span class="n">December</span><span class="p">{</span><span class="mi">12</span><span class="p">};</span>

<span class="p">}</span>
</pre></div>


<p></div>
カレンダーライブラリは, 例えばスカラ型で直接日付を指定するといったことはなく, 明示的な型指定による表現によって実現する.
なお, 部分カレンダー型(<code>year</code>, <code>month</code> に加えて<code>day</code>型)は, すべて <i>Strong ordering</i><sup id="fnref-1"><a class="footnote-ref" href="#fn-1">1</a></sup> を満たし,&nbsp;加えて以下のメンバ関数をもつ.</p>
<ul>
<li>デフォルトコンストラクタ, <code>unsigned</code>型(<code>year</code>型のみ<code>int</code>型)の値を受け付けるコンストラクタ</li>
<li>各型の単位においてそれを前後に進める,&nbsp;{前|後}置{イン|デ}クリメント演算子</li>
<li>各型の単位で計算を行う<code>+</code>, <code>-</code>の二項演算子</li>
<li>二項演算子と同様の計算を行い自身に代入する<code>+=</code>, <code>-=</code> の複合代入演算子</li>
<li><code>unsigned</code>型(<code>year</code>型のみ<code>int</code>型)の値への明示的な変換(<code>constexpr explicit operator unsigned() const noexcept;</code>)</li>
<li>指定された日付が各単位で適切であるかどうかをチェックする<code>ok</code></li>
</ul>
<p><code>year</code>型は, これに加えて, <code>is_leap</code>, <code>min</code>, <code>max</code> メンバ関数をもつ. <code>is_leap</code>は, 指定された年が閏年であるか判定できる. <code>min</code>, <code>max</code>は内部型の最小値と最大値を返す.
また, 上記の通り<code>y</code>といったリテラル接尾語が定義される.<br>
また<code>day</code>型は, <code>d</code>といったリテラル接尾語が定義される.</p>
<p>フルカレンダー型は, <code>sys_days</code>という型へ変換できる. これは,&nbsp;次のように定義されている.</p>
<div class="highlight"><pre><span></span><span class="k">constexpr</span> <span class="n">year_month_day</span><span class="o">::</span><span class="k">operator</span> <span class="n">sys_days</span><span class="p">()</span> <span class="k">const</span> <span class="k">noexcept</span><span class="p">;</span>
</pre></div>


<p>フルカレンダー型は,<code>sys_days</code>型に変換することで,<code>system_clock::time_point</code>ファミリとの間で変換でき, これにより完全な相互運用が可能である. <code>sys_days</code> は
<em onclick="obj=document.getElementById('opensys_days').style; obj.display=(obj.display=='none')?'block':'none';">
<a style="font-style: normal; cursor:pointer;">次のように定義される(クリックで展開).</a>
</em>
<div id="opensys_days" style="display:none;clear:both;"></p>
<div class="highlight"><pre><span></span><span class="k">using</span> <span class="n">days</span> <span class="o">=</span> <span class="n">duration</span><span class="o">&lt;</span><span class="kt">int32_t</span><span class="p">,</span> <span class="n">ratio_multiply</span><span class="o">&lt;</span><span class="n">ratio</span><span class="o">&lt;</span><span class="mi">24</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">hours</span><span class="o">::</span><span class="n">period</span><span class="o">&gt;&gt;</span><span class="p">;</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">Duration</span><span class="o">&gt;</span>
<span class="k">using</span> <span class="n">sys_time</span> <span class="o">=</span> <span class="n">time_point</span><span class="o">&lt;</span><span class="n">system_clock</span><span class="p">,</span> <span class="n">Duration</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">using</span> <span class="n">sys_days</span> <span class="o">=</span> <span class="n">sys_time</span><span class="o">&lt;</span><span class="n">days</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>


</div>

<p>加えて, <code>sys_days</code>には次の特性がある.</p>
<ul>
<li><code>sys_days</code>は, <code>system_clock::time_point</code>がマイクロ秒, またはナノ秒のカウントだけであるのと同様に, <code>system_clock</code>の基点(エポック)からの日数を示す.</li>
<li><code>sys_days</code>は, 切り捨てエラーなしで暗黙的に<code>system_clock::time_point</code>に変換される.</li>
<li><code>system_clock::time_point</code>は, 切り捨てエラーが含まれるため, 暗黙的に<code>sys_days</code>に変換されない.</li>
<li><code>system_clock::time_point_cast</code> または<code>floor</code>を使用した明示的な変換によって<code>system_clock::time_point</code>から<code>sys_days</code>へ変換することができる.</li>
</ul>
<p>内部で保持する部分カレンダー型<code>year</code>, <code>month</code>, <code>day</code> をそれぞれ<code>y_</code>, <code>m_</code>, <code>d_</code> としたとき,
<code>year_month_day</code>から<code>sys_days</code>への変換時には(すなわち上記の<code>operator sys_days()</code>の呼び出し),</p>
<ul>
<li><code>year_month_day::ok()</code>が<code>true</code>の場合, <code>sys_days</code>の基点から<code>*this</code>までの日数を保持する<code>sys_days</code>を返す</li>
<li>そうでない場合, <code>y_.ok() &amp;&amp; m_.ok() == true</code> ならば <code>sys_days{y_/m_/last}</code> から <code>days</code>(<code>duration&lt;int32_t, ratio_multiply&lt;ratio&lt;24&gt;, hours::period&gt;&gt;</code>) の数だけ<code>sys_days{y_,m_,last}.day()</code>からオフセットされた<code>sys_days</code>を返す</li>
<li>そうでない場合,&nbsp;未規定である</li>
</ul>
<p>ここで<code>year_month_day::ok</code>は,
<code>y_.ok() &amp;&amp; m_.ok() == true</code> <span class="math">\(\land\)</span> <code>1d</code> <span class="math">\(\leq\)</span> <code>d_</code> <span class="math">\(\leq\)</span> <code>(y_/m_/last).day()</code> であるとき <code>true</code> を, そうでない場合, <code>false</code> を返すメンバ関数である.</p>
<div class="highlight"><pre><span></span><span class="k">constexpr</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">system_clock</span><span class="o">::</span><span class="n">time_point</span> <span class="n">tp</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">sys_days</span><span class="p">{</span><span class="mi">2016</span><span class="n">y</span><span class="o">/</span><span class="n">May</span><span class="o">/</span><span class="mi">29</span><span class="n">d</span><span class="p">};</span> <span class="c1">// Convert date to time_point</span>
<span class="k">static_assert</span><span class="p">(</span><span class="n">tp</span><span class="p">.</span><span class="n">time_since_epoch</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="err">&#39;</span><span class="mi">464</span><span class="err">&#39;</span><span class="mi">480</span><span class="err">&#39;</span><span class="mo">000</span><span class="err">&#39;</span><span class="mo">000</span><span class="err">&#39;</span><span class="mo">000u</span><span class="n">s</span><span class="p">);</span>
<span class="k">constexpr</span> <span class="k">auto</span> <span class="n">ymd</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">year_month_day</span><span class="p">{</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">floor</span><span class="o">&lt;</span><span class="n">days</span><span class="o">&gt;</span><span class="p">(</span><span class="n">tp</span><span class="p">)};</span> <span class="c1">// Convert time_point to date</span>
<span class="k">static_assert</span><span class="p">(</span><span class="n">ymd</span> <span class="o">==</span> <span class="mi">2016</span><span class="n">y</span><span class="o">/</span><span class="n">May</span><span class="o">/</span><span class="mi">29</span><span class="n">d</span><span class="p">);</span>
<span class="k">constexpr</span> <span class="k">auto</span> <span class="n">tp</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">sys_days</span><span class="p">{</span><span class="mi">2016</span><span class="n">y</span><span class="o">/</span><span class="n">May</span><span class="o">/</span><span class="mi">29</span><span class="n">d</span><span class="p">}</span> <span class="o">+</span> <span class="mi">7</span><span class="n">h</span> <span class="o">+</span> <span class="mi">30</span><span class="n">min</span><span class="p">;</span> <span class="c1">// 2016-05-29 07:30 UTC</span>
<span class="k">static_assert</span><span class="p">(</span><span class="n">year_month_day</span><span class="p">{</span><span class="n">sys_days</span><span class="p">{</span><span class="mi">2017</span><span class="n">y</span><span class="o">/</span><span class="n">January</span><span class="o">/</span><span class="mi">0</span><span class="p">}}</span>  <span class="o">==</span> <span class="mi">2016</span><span class="n">y</span><span class="o">/</span><span class="n">December</span><span class="o">/</span><span class="mi">31</span><span class="p">);</span>
<span class="k">static_assert</span><span class="p">(</span><span class="n">year_month_day</span><span class="p">{</span><span class="n">sys_days</span><span class="p">{</span><span class="mi">2017</span><span class="n">y</span><span class="o">/</span><span class="n">January</span><span class="o">/</span><span class="mi">31</span><span class="p">}}</span> <span class="o">==</span> <span class="mi">2017</span><span class="n">y</span><span class="o">/</span><span class="n">January</span><span class="o">/</span><span class="mi">31</span><span class="p">);</span>
<span class="k">static_assert</span><span class="p">(</span><span class="n">year_month_day</span><span class="p">{</span><span class="n">sys_days</span><span class="p">{</span><span class="mi">2017</span><span class="n">y</span><span class="o">/</span><span class="n">January</span><span class="o">/</span><span class="mi">32</span><span class="p">}}</span> <span class="o">==</span> <span class="mi">2017</span><span class="n">y</span><span class="o">/</span><span class="n">February</span><span class="o">/</span><span class="mi">1</span><span class="p">);</span>
</pre></div>


<p>上述した, <code>days</code>の他に, <code>weeks</code>, <code>months</code>, <code>years</code> が
<em onclick="obj=document.getElementById('openpartialcal').style; obj.display=(obj.display=='none')?'block':'none';">
<a style="font-style: normal; cursor:pointer;">次のように定義される(クリックで展開).</a>
</em>
<div id="openpartialcal" style="display:none;clear:both;"></p>
<div class="highlight"><pre><span></span><span class="k">using</span> <span class="n">weeks</span>  <span class="o">=</span> <span class="n">duration</span><span class="o">&lt;</span><span class="cm">/* signed integer type of at least 22 bits */</span><span class="p">,</span> <span class="n">ratio_multiply</span><span class="o">&lt;</span><span class="n">ratio</span><span class="o">&lt;</span><span class="mi">7</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">days</span><span class="o">::</span><span class="n">period</span><span class="o">&gt;&gt;</span><span class="p">;</span>
<span class="k">using</span> <span class="n">years</span>  <span class="o">=</span> <span class="n">duration</span><span class="o">&lt;</span><span class="cm">/* signed integer type of at least 17 bits */</span><span class="p">,</span> <span class="n">ratio_multiply</span><span class="o">&lt;</span><span class="n">ratio</span><span class="o">&lt;</span><span class="mi">146097</span><span class="p">,</span> <span class="mi">400</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">days</span><span class="o">::</span><span class="n">period</span><span class="o">&gt;&gt;</span><span class="p">;</span>
<span class="k">using</span> <span class="n">months</span> <span class="o">=</span> <span class="n">duration</span><span class="o">&lt;</span><span class="cm">/* signed integer type of at least 20 bits */</span><span class="p">,</span> <span class="n">ratio_divide</span><span class="o">&lt;</span><span class="n">years</span><span class="o">::</span><span class="n">period</span><span class="p">,</span> <span class="n">ratio</span><span class="o">&lt;</span><span class="mi">12</span><span class="o">&gt;&gt;&gt;</span><span class="p">;</span>
</pre></div>


</div>

<ul>
<li><code>days</code>, <code>weeks</code>, <code>months</code>, <code>years</code>型は, それぞれ少なくとも <span class="math">\(\pm\)</span>40000&nbsp;年の範囲をカバーする.</li>
<li><code>hours</code>のリテラル接尾語が<code>h</code>, <code>minutes</code>のリテラル接尾語が<code>min</code>, というように, 今までのリテラル接尾語は<code>duration</code>型へ対応していたが, 新規に追加される <code>y</code>, <code>d</code>といったリテラル接尾語は, <code>years</code>, <code>days</code>に対応するリテラル接尾語ではなく, 上述したように, <code>year</code>, <code>day</code>の部分カレンダー型に対応するリテラル接尾語である.</li>
<li>1 年を, 365.2425 日(グレゴリオ暦の平均長)と定義し, 1 月を, 30.436875 日<span class="math">\(\left(\dfrac{1}{12}\right)\)</span> と定義するため,  システム時刻(<code>time_point</code>)を利用した算出結果と, <code>year_month_day</code> を利用した算出結果は異なる.</li>
</ul>
<div class="highlight"><pre><span></span><span class="k">constexpr</span> <span class="k">auto</span> <span class="n">date1</span> <span class="o">=</span> <span class="n">sys_days</span><span class="p">{</span><span class="mi">1997</span><span class="n">y</span><span class="o">/</span><span class="n">May</span><span class="o">/</span><span class="mi">30</span><span class="n">d</span><span class="p">}</span> <span class="o">-</span> <span class="n">months</span><span class="p">{</span><span class="mi">5</span><span class="p">};</span> <span class="c1">// 1996-12-28 19:34:30</span>
<span class="k">constexpr</span> <span class="k">auto</span> <span class="n">date2</span> <span class="o">=</span> <span class="n">sys_days</span><span class="p">{</span><span class="mi">1997</span><span class="n">y</span><span class="o">/</span><span class="n">December</span><span class="o">/</span><span class="mi">29</span><span class="n">d</span><span class="p">}</span> <span class="o">-</span> <span class="n">years</span><span class="p">{</span><span class="mi">1</span><span class="p">};</span> <span class="c1">// 1996-12-28 18:10:48</span>
</pre></div>


<p>現実のカレンダーの利用方法として, たとえば「2016 年の 5 月 29 日」を, 「2016 年の 5 月第 5 日曜日」ということもよくあり,&nbsp;これを表現することもできる.</p>
<div class="highlight"><pre><span></span><span class="k">constexpr</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">system_clock</span><span class="o">::</span><span class="n">time_point</span> <span class="n">tp</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">sys_days</span><span class="p">{</span><span class="n">Sunday</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">/</span><span class="n">May</span><span class="o">/</span><span class="mi">2016</span><span class="p">};</span> <span class="c1">// Convert date to time_point</span>
<span class="k">static_assert</span><span class="p">(</span><span class="n">tp</span><span class="p">.</span><span class="n">time_since_epoch</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="err">&#39;</span><span class="mi">464</span><span class="err">&#39;</span><span class="mi">480</span><span class="err">&#39;</span><span class="mo">000</span><span class="err">&#39;</span><span class="mo">000</span><span class="err">&#39;</span><span class="mo">000u</span><span class="n">s</span><span class="p">);</span>
<span class="k">constexpr</span> <span class="k">auto</span> <span class="n">ymd</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">year_month_weekday</span><span class="p">{</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">floor</span><span class="o">&lt;</span><span class="n">days</span><span class="o">&gt;</span><span class="p">(</span><span class="n">tp</span><span class="p">)};</span> <span class="c1">// Convert time_point to date</span>
<span class="k">static_assert</span><span class="p">(</span><span class="n">ymd</span> <span class="o">==</span> <span class="n">Sunday</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">/</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">May</span><span class="o">/</span><span class="mi">2016</span><span class="p">);</span>
<span class="k">static_assert</span><span class="p">(</span><span class="mi">2016</span><span class="n">y</span><span class="o">/</span><span class="n">May</span><span class="o">/</span><span class="mi">29</span><span class="n">d</span> <span class="o">==</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">year_month_day</span><span class="p">{</span><span class="n">Sunday</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">/</span><span class="n">May</span><span class="o">/</span><span class="mi">2016</span><span class="p">});</span>

<span class="k">constexpr</span> <span class="k">auto</span> <span class="n">wdi</span> <span class="o">=</span> <span class="n">Sunday</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span> <span class="c1">// wdi is the 5th Sunday of an as yet unspecified month</span>
<span class="k">static_assert</span><span class="p">(</span><span class="n">wdi</span><span class="p">.</span><span class="n">weekday</span><span class="p">()</span> <span class="o">==</span> <span class="n">Sunday</span><span class="p">);</span>
<span class="k">static_assert</span><span class="p">(</span><span class="n">wdi</span><span class="p">.</span><span class="n">index</span><span class="p">()</span> <span class="o">==</span> <span class="mi">5</span><span class="p">);</span>
<span class="k">static_assert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_same</span><span class="o">&lt;</span><span class="k">decltype</span><span class="p">(</span><span class="n">Sunday</span><span class="p">),</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">weekday</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">);</span>
<span class="k">static_assert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_same</span><span class="o">&lt;</span><span class="k">decltype</span><span class="p">(</span><span class="n">wdi</span><span class="p">.</span><span class="n">index</span><span class="p">()),</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">weekday_indexed</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">);</span>
</pre></div>


<p>ここで, <code>Sunday</code>は<code>weekday</code>型であり, 日曜日を表現するリテラルとして定義され, 他にも<code>Monday</code>, <code>Tuesday</code>, <code>Wednesday</code>, <code>Thursday</code>, <code>Friday</code>, <code>Saturday</code>が
<em onclick="obj=document.getElementById('openweekday').style; obj.display=(obj.display=='none')?'block':'none';">
<a style="font-style: normal; cursor:pointer;">次のように定義される(クリックで展開).</a>
</em>
<div id="openweekday" style="display:none;clear:both;"></p>
<div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span> <span class="p">{</span>

<span class="kr">inline</span> <span class="k">constexpr</span> <span class="n">chrono</span><span class="o">::</span><span class="n">weekday</span> <span class="n">Sunday</span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>
<span class="kr">inline</span> <span class="k">constexpr</span> <span class="n">chrono</span><span class="o">::</span><span class="n">weekday</span> <span class="n">Monday</span><span class="p">{</span><span class="mi">1</span><span class="p">};</span>
<span class="kr">inline</span> <span class="k">constexpr</span> <span class="n">chrono</span><span class="o">::</span><span class="n">weekday</span> <span class="n">Tuesday</span><span class="p">{</span><span class="mi">2</span><span class="p">};</span>
<span class="kr">inline</span> <span class="k">constexpr</span> <span class="n">chrono</span><span class="o">::</span><span class="n">weekday</span> <span class="n">Wednesday</span><span class="p">{</span><span class="mi">3</span><span class="p">};</span>
<span class="kr">inline</span> <span class="k">constexpr</span> <span class="n">chrono</span><span class="o">::</span><span class="n">weekday</span> <span class="n">Thursday</span><span class="p">{</span><span class="mi">4</span><span class="p">};</span>
<span class="kr">inline</span> <span class="k">constexpr</span> <span class="n">chrono</span><span class="o">::</span><span class="n">weekday</span> <span class="n">Friday</span><span class="p">{</span><span class="mi">5</span><span class="p">};</span>
<span class="kr">inline</span> <span class="k">constexpr</span> <span class="n">chrono</span><span class="o">::</span><span class="n">weekday</span> <span class="n">Saturday</span><span class="p">{</span><span class="mi">6</span><span class="p">};</span>

<span class="p">}</span>
</pre></div>


<p></div>
<code>weekday</code>型は, <i>Strong equality</i><sup id="fnref2-1"><a class="footnote-ref" href="#fn-1">1</a></sup> を満たし, 加えて,&nbsp;次のメンバ関数を持つ.</p>
<ul>
<li>デフォルトコンストラクタ, <code>unsigned</code>, <code>sys_days</code>, 後に取り上げている<code>local_days</code>型のオブジェクトを受け付けるコンストラクタ</li>
<li>曜日を前後に進める{前|後}置{イン|デ}クリメント演算子</li>
<li><code>weekday</code>, <code>days</code>型のオブジェクトを受け付けて曜日の計算を行う<code>+</code>, <code>-</code>の二項演算子</li>
<li>二項演算子と同様の計算を行い自身に代入する<code>+=</code>, <code>-=</code> の複合代入演算子</li>
<li>指定された曜日が適切であるかどうかをチェックする<code>ok</code></li>
<li><code>operator []</code></li>
</ul>
<p><code>operator []</code>は, <code>unsigned</code>型を引数として呼び出すと, <code>weekday_indexed</code>型のオブジェクトが返され, <code>last_spec</code>型のオブジェクトを引数として呼び出すと, <code>weekday_last</code>型のオブジェクトが返される.</p>
<ul>
<li><code>weekday_indexed</code>型は, 月の第 1, 第 2, 第 3, 第 4 または第 5 曜日を表すために使用され, 上記の通り, <code>weekday</code>メンバ関数, <code>index</code>メンバ関数を持つ他, <code>ok</code>メンバ関数を持つ.</li>
<li><code>weekday_last</code>型は, 月の最後の<code>weekday</code>を表すために使用され, <code>weekday</code>メンバ関数, <code>ok</code>メンバ関数を持つ,</li>
<li><code>last_spec</code>型は, 最終日を表すために使用され, 同型のオブジェクト<code>last</code>が<code>chrono</code>名前空間下に定義される.</li>
</ul>
<p>例えば次のようにして, ある月の最終日, 最終 <span class="math">\(X\)</span>&nbsp;曜日などを表現することができる.</p>
<div class="highlight"><pre><span></span><span class="k">auto</span> <span class="n">today</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">year_month_day</span><span class="p">{</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">floor</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">days</span><span class="o">&gt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">system_clock</span><span class="o">::</span><span class="n">now</span><span class="p">())};</span>
<span class="k">auto</span> <span class="n">last_day</span> <span class="o">=</span> <span class="n">today</span><span class="p">.</span><span class="n">year</span><span class="p">()</span><span class="o">/</span><span class="n">today</span><span class="p">.</span><span class="n">month</span><span class="p">()</span><span class="o">/</span><span class="n">last</span><span class="p">;</span> <span class="c1">// last day of this month</span>
<span class="k">auto</span> <span class="n">last_Sunday</span> <span class="o">=</span> <span class="n">today</span><span class="p">.</span><span class="n">year</span><span class="p">()</span><span class="o">/</span><span class="n">today</span><span class="p">.</span><span class="n">month</span><span class="p">()</span><span class="o">/</span><span class="n">Sunday</span><span class="p">[</span><span class="n">last</span><span class="p">];</span> <span class="c1">// last Sundayday of this month</span>

<span class="k">static_assert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_same</span><span class="o">&lt;</span><span class="k">decltype</span><span class="p">(</span><span class="n">Sunday</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">weekday_indexed</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">);</span>
<span class="k">static_assert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_same</span><span class="o">&lt;</span><span class="k">decltype</span><span class="p">(</span><span class="n">Sunday</span><span class="p">[</span><span class="n">last</span><span class="p">]),</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">weekday_last</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">);</span>
</pre></div>


<p>他に, 年を未指定とし, 特定の月日を表す, <code>month_day</code>, 月の最終日を表す<code>month_day_last</code>, <span class="math">\(N\)</span> 番目の曜日を表す<code>month_weekday</code>, 月の最終曜日を表す<code>month_weekday_last</code>と,
日を未指定とし, 特定の年月を表す, <code>year_month</code>, 前述した<code>year_month_day</code>, 特定の年月の最終日を表す<code>year_month_day_last</code>, 特定の年月の <span class="math">\(N\)</span> 番目の曜日を表す<code>year_month_weekday</code>,
特定の年月の最終曜日を表す<code>year_month_weekday_last</code> が提供される.</p>
<div class="highlight"><pre><span></span><span class="k">constexpr</span> <span class="k">auto</span> <span class="n">md</span> <span class="o">=</span> <span class="n">February</span><span class="o">/</span><span class="mi">1</span><span class="n">d</span><span class="p">;</span>
<span class="k">static_assert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_same</span><span class="o">&lt;</span><span class="k">decltype</span><span class="p">(</span><span class="n">md</span><span class="p">),</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">month_day</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">);</span>
<span class="k">constexpr</span> <span class="k">auto</span> <span class="n">mdl</span> <span class="o">=</span> <span class="n">February</span><span class="o">/</span><span class="n">last</span><span class="p">;</span>  <span class="c1">// mdl is the last day of February of an as yet unspecified year</span>
<span class="k">static_assert</span><span class="p">(</span><span class="n">mdl</span><span class="p">.</span><span class="n">month</span><span class="p">()</span> <span class="o">==</span> <span class="n">February</span><span class="p">);</span>
<span class="k">static_assert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_same</span><span class="o">&lt;</span><span class="k">decltype</span><span class="p">(</span><span class="n">mdl</span><span class="p">),</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">month_day_last</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">);</span>
<span class="n">constxpr</span> <span class="k">auto</span> <span class="n">mw</span> <span class="o">=</span> <span class="n">February</span><span class="o">/</span><span class="n">Sunday</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
<span class="k">static_assert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_same</span><span class="o">&lt;</span><span class="k">decltype</span><span class="p">(</span><span class="n">mw</span><span class="p">),</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">month_weekday</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">);</span>
<span class="k">constexpr</span> <span class="k">auto</span> <span class="n">mwl</span> <span class="o">=</span> <span class="n">February</span><span class="o">/</span><span class="n">Sunday</span><span class="p">[</span><span class="n">last</span><span class="p">];</span>
<span class="k">static_assert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_same</span><span class="o">&lt;</span><span class="k">decltype</span><span class="p">(</span><span class="n">mwl</span><span class="p">),</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">month_weekday_last</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">);</span>
<span class="k">constexpr</span> <span class="k">auto</span> <span class="n">ym</span> <span class="o">=</span> <span class="mi">2016</span><span class="n">y</span><span class="o">/</span><span class="n">February</span><span class="p">;</span>
<span class="k">static_assert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_same</span><span class="o">&lt;</span><span class="k">decltype</span><span class="p">(</span><span class="n">ym</span><span class="p">),</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">year_month</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">);</span>
<span class="k">constexpr</span> <span class="k">auto</span> <span class="n">ymd</span> <span class="o">=</span> <span class="mi">2016</span><span class="n">y</span><span class="o">/</span><span class="n">February</span><span class="o">/</span><span class="mi">1</span><span class="n">d</span><span class="p">;</span>
<span class="k">static_assert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_same</span><span class="o">&lt;</span><span class="k">decltype</span><span class="p">(</span><span class="n">ymd</span><span class="p">),</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">year_month_day</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">);</span>
<span class="k">constexpr</span> <span class="k">auto</span> <span class="n">ymdl</span> <span class="o">=</span> <span class="mi">2016</span><span class="n">y</span><span class="o">/</span><span class="n">February</span><span class="o">/</span><span class="n">last</span><span class="p">;</span>
<span class="k">static_assert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_same</span><span class="o">&lt;</span><span class="k">decltype</span><span class="p">(</span><span class="n">ymdl</span><span class="p">),</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">year_month_day_last</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">);</span>
<span class="k">constexpr</span> <span class="k">auto</span> <span class="n">ymw</span> <span class="o">=</span> <span class="mi">2016</span><span class="n">y</span><span class="o">/</span><span class="n">February</span><span class="o">/</span><span class="n">Sunday</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="k">static_assert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_same</span><span class="o">&lt;</span><span class="k">decltype</span><span class="p">(</span><span class="n">ymw</span><span class="p">),</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">year_month_weekday</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">);</span>
<span class="k">constexpr</span> <span class="k">auto</span> <span class="n">ymwl</span> <span class="o">=</span> <span class="mi">2016</span><span class="n">y</span><span class="o">/</span><span class="n">February</span><span class="o">/</span><span class="n">last</span><span class="p">;</span>
<span class="k">static_assert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_same</span><span class="o">&lt;</span><span class="k">decltype</span><span class="p">(</span><span class="n">ymwl</span><span class="p">),</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">year_month_day_last</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">);</span>
</pre></div>


<p>フルカレンダー型, 部分カレンダー型, <code>sys_days</code>型の全てで, <code>operator &lt;&lt;</code>のオーバーロードによる <span class="caps">IO</span> ストリームへの出力機能が提供される他, 非メンバ関数として, <code>to_stream</code>, <code>from_stream</code> が提供される.
これらはそれぞれ, 指定されたフォーマットの通りに出力する機能と,&nbsp;指定されたフォーマットを使用して入力ストリームから解析する機能を持つ.</p>
<div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">sys_days</span><span class="p">{</span><span class="n">Sunday</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">/</span><span class="n">May</span><span class="o">/</span><span class="mi">2016</span><span class="p">}</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="c1">// 2016-05-29</span>
<span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">to_stream</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">,</span> <span class="s">&quot;%b/%d/%Y %A %T&quot;</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">sys_days</span><span class="p">{</span><span class="mi">2016</span><span class="n">y</span><span class="o">/</span><span class="n">May</span><span class="o">/</span><span class="mi">29</span><span class="n">d</span><span class="p">}</span> <span class="o">+</span> <span class="mi">30</span><span class="n">min</span><span class="p">);</span> <span class="c1">// May/29/2016 Sunday 00:30:00</span>

<span class="k">auto</span> <span class="n">is</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">istringstream</span><span class="p">{</span><span class="s">&quot;2016-5-26&quot;</span><span class="p">};</span>
<span class="k">auto</span> <span class="n">tp</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">sys_days</span><span class="p">{};</span>
<span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">from_stream</span><span class="p">(</span><span class="n">in</span><span class="p">,</span> <span class="s">&quot;%F&quot;</span><span class="p">,</span> <span class="n">tp</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">is</span><span class="p">.</span><span class="n">fail</span><span class="p">())</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">tp</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="c1">// 2016-05-26</span>
</pre></div>


<p>また, <code>time_of_day</code>クラスが提供される. これは, <code>hours</code>, <code>minutes</code>, <code>seconds</code>, <code>duration&lt;Rep, Period&gt;</code> の 4 つに対する特殊化が行われており,
それぞれ午前 0 時からの時間, 時間:分, 時間:分:秒, 時間:分:秒:<span class="math">\(X\)</span>&nbsp;といった書式設定ができる.</p>
<div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">time_of_day</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">hours</span><span class="o">&gt;</span> <span class="n">todh</span><span class="p">(</span><span class="mi">1</span><span class="n">h</span><span class="p">);</span>
<span class="n">todh</span><span class="p">.</span><span class="n">make12</span><span class="p">();</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">todh</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span> <span class="c1">// 1am</span>
<span class="n">todh</span><span class="p">.</span><span class="n">make24</span><span class="p">();</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">todh</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span> <span class="c1">// 0100</span>

<span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">time_of_day</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">minutes</span><span class="o">&gt;</span> <span class="n">todm</span><span class="p">(</span><span class="mi">1</span><span class="n">h</span> <span class="o">+</span> <span class="mi">30</span><span class="n">min</span><span class="p">);</span>
<span class="n">todm</span><span class="p">.</span><span class="n">make12</span><span class="p">();</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">todm</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span> <span class="c1">// 1:30am</span>
<span class="n">todm</span><span class="p">.</span><span class="n">make24</span><span class="p">();</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">todm</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span> <span class="c1">// 01:30</span>

<span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">time_of_day</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">seconds</span><span class="o">&gt;</span> <span class="n">tods</span><span class="p">(</span><span class="mi">1</span><span class="n">h</span> <span class="o">+</span> <span class="mi">30</span><span class="n">min</span> <span class="o">+</span> <span class="mi">30</span><span class="n">s</span><span class="p">);</span>
<span class="n">tods</span><span class="p">.</span><span class="n">make12</span><span class="p">();</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">tods</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span> <span class="c1">// 1:30:30am</span>
<span class="n">tods</span><span class="p">.</span><span class="n">make24</span><span class="p">();</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">tods</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span> <span class="c1">// 01:30:30</span>

<span class="n">std</span><span class="o">::</span><span class="n">chdono</span><span class="o">::</span><span class="n">time_of_day</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">milliseconds</span><span class="o">&gt;</span> <span class="n">todms</span><span class="p">(</span><span class="mi">1</span><span class="n">h</span> <span class="o">+</span> <span class="mi">30</span><span class="n">min</span> <span class="o">+</span> <span class="mi">30</span><span class="n">s</span> <span class="o">+</span> <span class="mi">30</span><span class="n">ms</span><span class="p">);</span>
<span class="n">todms</span><span class="p">.</span><span class="n">make12</span><span class="p">();</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">todms</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span> <span class="c1">// 1:30:30.030am</span>
<span class="n">todms</span><span class="p">.</span><span class="n">make24</span><span class="p">();</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">todms</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span> <span class="c1">// 01:30:30.030</span>
</pre></div>


<h3>タイムゾーン</h3>
<p>タイムゾーンライブラリは, <a href="http://www.iana.org/time-zones"><span class="caps">IANA</span> Time Zone Database</a> のパーサーとして提供される<sup id="fnref-2"><a class="footnote-ref" href="#fn-2">2</a></sup>.
<a href="http://www.iana.org/time-zones"><span class="caps">IANA</span> Time Zone Database</a> には, <span class="caps">UTC</span> からのオフセットと地域の省略名<sup id="fnref-3"><a class="footnote-ref" href="#fn-3">3</a></sup>が含まれており, さらに該当する場合, 夏時間(サマータイム)のルールも含まれる.
これを表現した, <code>tzdb</code>, またバージョンごとの<code>tzdb</code>のリストとなっている<code>tzdb_list</code>を介して, 任意の<code>tzdb</code>にアクセスすることができる.
<code>tzdb_list</code>はシングルトンであり, 非メンバ関数<code>get_tzdb_list</code>からその参照を得て利用する.
<em onclick="obj=document.getElementById('opentimezones').style; obj.display=(obj.display=='none')?'block':'none';">
<a style="font-style: normal; cursor:pointer;">関連する宣言を下記に抜粋する(クリックで展開).</a>
</em>
<div id="opentimezones" style="display:none;clear:both;"></p>
<div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="n">std</span> <span class="p">{</span> <span class="k">namespace</span> <span class="n">chrono</span> <span class="p">{</span>

<span class="k">struct</span> <span class="n">local_t</span> <span class="p">{};</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">Duration</span><span class="o">&gt;</span>
<span class="k">using</span> <span class="n">local_time</span> <span class="o">=</span> <span class="n">time_point</span><span class="o">&lt;</span><span class="n">local_t</span><span class="p">,</span> <span class="n">Duration</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">using</span> <span class="n">local_seconds</span> <span class="o">=</span> <span class="n">local_time</span><span class="o">&lt;</span><span class="n">seconds</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">using</span> <span class="n">local_days</span> <span class="o">=</span> <span class="n">local_time</span><span class="o">&lt;</span><span class="n">days</span><span class="o">&gt;</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">sys_info</span> <span class="p">{</span>
    <span class="n">sys_seconds</span>   <span class="n">begin</span><span class="p">;</span>
    <span class="n">sys_seconds</span>   <span class="n">end</span><span class="p">;</span>
    <span class="n">seconds</span>       <span class="n">offset</span><span class="p">;</span>
    <span class="n">minutes</span>       <span class="n">save</span><span class="p">;</span>
    <span class="n">string</span>        <span class="n">abbrev</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">local_info</span> <span class="p">{</span>
    <span class="k">enum</span> <span class="p">{</span><span class="n">unique</span><span class="p">,</span> <span class="n">nonexistent</span><span class="p">,</span> <span class="n">ambiguous</span><span class="p">}</span> <span class="n">result</span><span class="p">;</span>
    <span class="n">sys_info</span> <span class="n">first</span><span class="p">;</span>
    <span class="n">sys_info</span> <span class="n">second</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="k">class</span> <span class="nc">choose</span> <span class="p">{</span><span class="n">earliest</span><span class="p">,</span> <span class="n">latest</span><span class="p">};</span>

<span class="k">class</span> <span class="nc">time_zone</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">time_zone</span><span class="p">(</span><span class="k">const</span> <span class="n">time_zone</span><span class="o">&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="k">delete</span><span class="p">;</span>
    <span class="n">time_zone</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">time_zone</span><span class="o">&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="k">delete</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span> <span class="n">name</span><span class="p">()</span> <span class="k">const</span> <span class="k">noexcept</span><span class="p">;</span>
    <span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">Duration</span><span class="o">&gt;</span> <span class="n">sys_info</span>   <span class="n">get_info</span><span class="p">(</span><span class="n">sys_time</span><span class="o">&lt;</span><span class="n">Duration</span><span class="o">&gt;</span> <span class="n">st</span><span class="p">)</span>   <span class="k">const</span><span class="p">;</span>
    <span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">Duration</span><span class="o">&gt;</span> <span class="n">local_info</span> <span class="n">get_info</span><span class="p">(</span><span class="n">local_time</span><span class="o">&lt;</span><span class="n">Duration</span><span class="o">&gt;</span> <span class="n">tp</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>

    <span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">Duration</span><span class="o">&gt;</span>
    <span class="n">sys_time</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">common_type</span><span class="o">&lt;</span><span class="n">Duration</span><span class="p">,</span> <span class="n">seconds</span><span class="o">&gt;::</span><span class="n">type</span><span class="o">&gt;</span>
    <span class="n">to_sys</span><span class="p">(</span><span class="n">local_time</span><span class="o">&lt;</span><span class="n">Duration</span><span class="o">&gt;</span> <span class="n">tp</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>

    <span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">Duration</span><span class="o">&gt;</span>
    <span class="n">sys_time</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">common_type</span><span class="o">&lt;</span><span class="n">Duration</span><span class="p">,</span> <span class="n">seconds</span><span class="o">&gt;::</span><span class="n">type</span><span class="o">&gt;</span>
    <span class="n">to_sys</span><span class="p">(</span><span class="n">local_time</span><span class="o">&lt;</span><span class="n">Duration</span><span class="o">&gt;</span> <span class="n">tp</span><span class="p">,</span> <span class="n">choose</span> <span class="n">z</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>

    <span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">Duration</span><span class="o">&gt;</span>
    <span class="n">local_time</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">common_type</span><span class="o">&lt;</span><span class="n">Duration</span><span class="p">,</span> <span class="n">seconds</span><span class="o">&gt;::</span><span class="n">type</span><span class="o">&gt;</span>
    <span class="n">to_local</span><span class="p">(</span><span class="n">sys_time</span><span class="o">&lt;</span><span class="n">Duration</span><span class="o">&gt;</span> <span class="n">tp</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">tzdb</span> <span class="p">{</span>
    <span class="n">string</span>            <span class="n">version</span><span class="p">;</span>
    <span class="n">vector</span><span class="o">&lt;</span><span class="n">time_zone</span><span class="o">&gt;</span> <span class="n">zones</span><span class="p">;</span>
    <span class="n">vector</span><span class="o">&lt;</span><span class="n">link</span><span class="o">&gt;</span>      <span class="n">links</span><span class="p">;</span>
    <span class="n">vector</span><span class="o">&lt;</span><span class="n">leap</span><span class="o">&gt;</span>      <span class="n">leaps</span><span class="p">;</span>

    <span class="k">const</span> <span class="n">time_zone</span><span class="o">*</span> <span class="nf">locate_zone</span><span class="p">(</span><span class="n">string_view</span> <span class="n">tz_name</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">time_zone</span><span class="o">*</span> <span class="nf">current_zone</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">tzdb_list</span> <span class="p">{</span>
    <span class="n">atomic</span><span class="o">&lt;</span><span class="n">tzdb</span><span class="o">*&gt;</span> <span class="n">head_</span><span class="p">{</span><span class="k">nullptr</span><span class="p">};</span>  <span class="c1">// exposition only</span>
<span class="k">public</span><span class="o">:</span>
    <span class="k">class</span> <span class="nc">const_iterator</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">tzdb</span><span class="o">&amp;</span> <span class="n">front</span><span class="p">()</span> <span class="k">const</span> <span class="k">noexcept</span><span class="p">;</span>
    <span class="n">const_iterator</span> <span class="nf">erase_after</span><span class="p">(</span><span class="n">const_iterator</span> <span class="n">p</span><span class="p">)</span> <span class="k">noexcept</span><span class="p">;</span>

    <span class="n">const_iterator</span> <span class="nf">begin</span><span class="p">()</span> <span class="k">const</span> <span class="k">noexcept</span><span class="p">;</span>
    <span class="n">const_iterator</span> <span class="nf">end</span><span class="p">()</span>   <span class="k">const</span> <span class="k">noexcept</span><span class="p">;</span>

    <span class="n">const_iterator</span> <span class="nf">cbegin</span><span class="p">()</span> <span class="k">const</span> <span class="k">noexcept</span><span class="p">;</span>
    <span class="n">const_iterator</span> <span class="nf">cend</span><span class="p">()</span>   <span class="k">const</span> <span class="k">noexcept</span><span class="p">;</span>
<span class="p">};</span>

<span class="p">}</span> <span class="p">}</span>
</pre></div>


</div>

<ul>
<li><code>local_time</code>は<code>local_t</code>という空の擬似クロック型が指定されており, これは当然 C++ の Clock ライブラリコンセプトを満たしていないが,&nbsp;未定義のタイムゾーンに関するローカル時刻であることを示す.</li>
<li><code>sys_info</code>構造体は, <code>time_zone</code>と<code>sys_time</code>, または<code>local_time</code>の組み合わせ, および<code>zoned_time</code>から取得することができる. 実質的には, <code>time_zone</code>と<code>sys_time</code>のペアであり, 低レベル <span class="caps">API</span> を表現する. <code>sys_time</code>から<code>local_time</code>への通常の変換では, 暗黙的にこの構造体が使用される.<ul>
<li><code>begin</code>, <code>end</code>フィールドは, <code>time_zone</code>および<code>time_point</code>について<code>offset</code>と<code>abbrev</code>が<span class="math">\([\)</span><code>begin</code>, <code>end</code><span class="math">\()\)</span>&nbsp;であることを示す.</li>
<li><code>offset</code>フィールドは, 関連する<code>time_zone</code>および<code>time_point</code>に有効な <span class="caps">UTC</span> オフセットを示す(<code>offset = local_time - sys_time</code>).</li>
<li><code>save</code>フィールドは, 通常<code>local_time</code>と<code>sys_time</code>の変換では必要のない&#8221;余分な&#8221;情報であるが, サマータイムの対応で必要となる. <code>save != 0min</code>の場合, この <code>sys_info</code> はサマータイムの時間帯にあると判断する. <code>offset - save</code>によって, この<code>time_zone</code>がサマータイムに対応できていない可能性を導出できる. しかし, この情報は正式なものではなく, そのような情報を確実に取得する唯一の方法は, <code>save == 0min</code>である<code>sys_info</code>を返す<code>time_point</code>と, 確認したい<code>time_zone</code>を照会することである.</li>
<li><code>abbrev</code>フィールドは, 関連する<code>time_zone</code>および<code>time_point</code>に使用される現在の略語を示す. 略語は, <code>time_zone</code>間で一意でないため, 略語を<code>time_zone</code>と <span class="caps">UTC</span>&nbsp;のオフセットに確実にマッピングすることはできない</li>
<li><span class="caps">IO</span> ストリームに対応している. <code>zoned_time zt = { "Asia/Tokyo", system_clock::now() }; std::cout &lt;&lt; zt.get_info() &lt;&lt; '\n';</code></li>
</ul>
</li>
<li><code>local_info</code>構造体は, 低レベル <span class="caps">API</span> を表す. <code>local_time</code>から<code>sys_time</code>への通常の変換では, 暗黙的にこの構造体が使用される.<ul>
<li><code>local_time</code>から<code>sys_time</code>への変換が唯一(サマータイムでない)で, <code>result == unique</code> である場合, <code>first</code>が正しい<code>sys_info</code>がセットされ, <code>second</code>が 0&nbsp;で初期化される.</li>
<li>変換が存在しない(<code>result == noexistent</code>)<sup id="fnref4-6"><a class="footnote-ref" href="#fn-6">6</a></sup>場合, <code>first</code>は<code>local_time</code>の直前で終了する<code>sys_info</code>がセットされ, <code>second</code>は<code>local_time</code>の直後に開始する<code>sys_info</code>がセットされる.</li>
<li>変換が曖昧(<code>result == ambiguous</code>)<sup id="fnref5-6"><a class="footnote-ref" href="#fn-6">6</a></sup>な場合, <code>first</code>は<code>local_time</code>の直後に終了する<code>sys_info</code>がセットされ, <code>second</code>は<code>local_time</code>の直前で開始する<code>sys_info</code>がセットされる.</li>
<li><span class="caps">IO</span> ストリームに対応している. <code>std::cout &lt;&lt; get_tzdb().current_zone()-&gt;get_info(local_days{2016y/May/29d}) &lt;&lt; '\n';</code></li>
</ul>
</li>
<li><code>time_zone</code>構造体は, 特定の地域の全てのタイムゾーン遷移を表現する. データベースの初期化の過程で, 現在地のタイムゾーン, およびタイムゾーンの情報をなんらかの方法<sup id="fnref-4"><a class="footnote-ref" href="#fn-4">4</a></sup><sup id="fnref2-5"><a class="footnote-ref" href="#fn-5">5</a></sup>で構築する. <i>Strong ordering</i><sup id="fnref5-1"><a class="footnote-ref" href="#fn-1">1</a></sup> を満たす.<ul>
<li><code>name</code>メンバ関数によって, <code>time_zone</code>の名前<sup id="fnref2-3"><a class="footnote-ref" href="#fn-3">3</a></sup>を取得できる.</li>
<li><code>get_info</code>メンバ関数によって, <code>sys_info</code>, <code>local_info</code>を取得できる.</li>
<li><code>to_sys</code>メンバ関数によって, <code>sys_time</code>, <code>local_time</code>を取得できる.<ul>
<li><code>time_zone::to_sys(local_time&lt;Duration&gt; tp) const;</code>: 少なくとも<code>seconds</code>と同じぐらいの<code>sys_time</code>であり, 引数の精度がさらに高ければそれに合わせられる. <code>tp</code>から<code>sys_time</code>への変換が曖昧<sup id="fnref-6"><a class="footnote-ref" href="#fn-6">6</a></sup>である場合, <code>ambiguous_local_time</code>例外をスローする<sup id="fnref-7"><a class="footnote-ref" href="#fn-7">7</a></sup>. <code>tp</code>から<code>sys_time</code>への変換が存在しない<sup id="fnref2-6"><a class="footnote-ref" href="#fn-6">6</a></sup>場合, <code>nonexistent_local_time</code>例外をスローする<sup id="fnref-8"><a class="footnote-ref" href="#fn-8">8</a></sup>.</li>
<li><code>time_zone::to_sys(local_time&lt;Duration&gt; tp, choose z) const;</code>: 少なくとも<code>seconds</code>と同じぐらいの<code>sys_time</code>であり, 引数の精度がさらに高ければそれに合わせられる. <code>tp</code>から<code>sys_time</code>への変換が曖昧<sup id="fnref3-6"><a class="footnote-ref" href="#fn-6">6</a></sup>があいまいである場合, <code>z == choose::earliest</code>の場合は, サマータイム以前の<code>sys_time</code>を返し, <code>z == choose::latest</code>の場合は, サマータイム以後の<code>sys_time</code>を返す. <code>tp</code> が 2 つの <span class="caps">UTC</span> <code>time_point</code>の間に存在しない時間を表す場合, 2 つの <span class="caps">UTC</span> <code>time_point</code>は同じになり, <span class="caps">UTC</span> <code>time_point</code>が返される.</li>
<li><code>time_zone::to_local(sys_time&lt;Duration&gt; tp) const;</code>: <code>tp</code> と自身の<code>time_zone</code>に関連づけられた<code>local_time</code>を返す.    </li>
</ul>
</li>
</ul>
</li>
<li><code>tzdb</code>は, 前述した通り, タイムゾーンデータベースを表現する.<ul>
<li><code>version</code>は, そのデータベースバージョンを表す. <code>zones</code>, <code>links</code>, <code>leaps</code>は, 検索の高速化のために,&nbsp;構築時に昇順ソートされる.</li>
<li><code>locate_zone</code>メンバ関数から, 与えられた<code>string_view</code>オブジェクトと<code>name()</code>が等価である<code>time_zone</code>が見つかった場合, その<code>time_zone</code>へのポインタを取得できる. そうでない場合, 与えられた<code>string_view</code>と<code>link.name()</code>(ここで, <code>link</code>は後述している<code>time_zone</code>の代替名を表現するクラスである)が等価である<code>link</code>が見つかった場合, <code>zone.name() == link.target()</code>の<code>time_zone</code>ポインタが取得できる. そうでない場合, <code>runtime_error</code>例外を送出する. 例外送出以外でこの関数から処理が返るとき, 返される戻り値は必ず有効な<code>time_zone</code>へのポインタである.</li>
<li><code>current_zone</code>メンバ関数から,&nbsp;コンピューターに設定されたローカルタイムゾーンを取得できる.</li>
</ul>
</li>
<li><code>tzdb_list</code>は, <code>tzdb</code>のアトミックポインターをもつ, <code>tzdb</code>のシングルトンリストである.　複数のバージョンのデータベースを, 同リストを介して一度に使用することができる. 例:<code>for (auto&amp;&amp; v : get_tzdb_list()) { std::cout &lt;&lt; v &lt;&lt; '\n'; }</code><ul>
<li><code>front</code>メンバ関数によって, 先頭<code>tzdb</code>の参照を得ることができる. これは, <code>reload_tzdb</code>非メンバ関数に対してスレッドセーフである.</li>
<li><code>erase_after</code>メンバ関数によって, 与えられたイテレータの後に参照する<code>tzdb</code>を消去する. 消去された要素の次の要素を指すイテレータが返される. そのような要素が存在しない場合, メンバ関数<code>end</code>を呼び出し, その結果を返す. なお, ここで消去された<code>tzdb</code>を参照することを除いて, ポインター, 参照, イテレータは無効にならない. また, メンバ関数<code>begin</code>を呼び出し, それによって参照される<code>tzdb</code>を消去することはできない.</li>
<li><code>begin</code>メンバ関数によって, コンテナ内の最初の<code>tzdb</code>を参照するイテレータ取得できる. <code>cbegin</code>メンバ関数は<code>begin</code>メンバ関数の<code>const</code>版である.</li>
<li><code>end</code>メンバ関数によって, コンテナ内の最後の<code>tzdb</code>より 1 つ後ろの位置を参照するイテレータを取得できる. <code>cend</code>メンバ関数は<code>end</code>メンバ関数の<code>const</code>版である.</li>
<li><code>get_tzdb_list</code>非メンバ関数によって, 同リストの参照を得ることができる. 同メンバ関数への呼び出しがデータベースへの最初のアクセスである場合, データベースを初期化する. この呼び出しによってデータベースが初期化された場合, <code>tzdb</code>を一つ持つ<code>tzdb_list</code>が構築される. 同メンバ関数を一度に複数のスレッドから呼び出しても競合せず, スレッドセーフである. 何らかの理由で有効なリストの参照を返せず, 1 つ以上の有効な<code>tzdb</code>を含む場合, <code>runtime_error</code>例外を送出する.</li>
<li><code>get_tzdb</code>非メンバ関数によって, 同リストの先頭<code>tzdb</code>の参照を得ることができる(<code>get_tzdb_list().front()</code>).</li>
<li><code>locate_zone</code>非メンバ関数によって, 次の値を得ることができる. なお, これがデータベースへの最初のアクセスである場合, データベースを初期化する. <code>get_tzdb().locate_zone(tz_name);</code></li>
<li><code>current_zone</code>非メンバ関数によって, 次の値を得ることができる. <code>get_tzdb().current_zone();</code></li>
</ul>
</li>
</ul>
<p><i>ローカル</i>タイムゾーンデータベースは、アプリケーションがデータベースに最初にアクセスするとき, たとえば<code>current_zone()</code>を介して実装によって提供される.
アプリケーションが実行されている間, 実装はタイムゾーンデータベースの更新を選択することがある.
このアップデートは, アプリケーションによって次に挙げる関数を呼び出さない限り, アプリケーションに影響を与えることはない.
この潜在的に更新されたタイムゾーンデータベースは, <i>リモート</i>タイムゾーンデータベースと呼ぶ.
<em onclick="obj=document.getElementById('openremotetimezone').style; obj.display=(obj.display=='none')?'block':'none';">
<a style="font-style: normal; cursor:pointer;">次のように定義される(クリックで展開).</a>
</em>
<div id="openremotetimezone" style="display:none;clear:both;"></p>
<div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="n">std</span> <span class="p">{</span> <span class="k">namespace</span> <span class="n">chrono</span> <span class="p">{</span>

<span class="k">const</span> <span class="n">tzdb</span><span class="o">&amp;</span> <span class="n">reload_tzdb</span><span class="p">();</span>
<span class="n">string</span> <span class="nf">remote_version</span><span class="p">();</span>

<span class="p">}</span> <span class="p">}</span>
</pre></div>


</div>

<ul>
<li><code>reload_tzdb</code>非メンバ関数は, 最初にリモートタイムゾーンデータベースのチェックを行い, ローカルデータベースとリモートデータベースのバージョンが同じである場合はなにもしない. それ以外の場合, リモートデータベースは, <code>get_tzdb_list</code>非メンバ関数によってアクセスされる<code>tzdb_list</code>の先頭にプッシュされる. いずれの場合も, <code>get_tzdb_list().front()</code> が返される. この関数は, <code>get_tzdb_list().front()</code>と<code>get_tzdb_list().erase_after()</code>に対してスレッドセーフである. 何らかの理由で有効な<code>tzdb</code>の参照が戻されない場合, <code>runtime_error</code>例外が送出される.</li>
<li><code>remote_version</code>非メンバ関数は, 最新のリモートデータベースバージョンの文字列(<code>std::string</code>)を返す. リモートバージョンが利用できない場合, 空の文字列が返される. 空でない場合, これを<code>get_tzdb_list().version</code>と比較して,&nbsp;ローカルデータベースとリモートデータベースが同等かどうかをチェックできる.</li>
</ul>
<p><code>zoned_traits</code>, <code>zoned_time</code>を利用することで, <code>sys_days</code>, <code>local_days</code>といった<code>time_point</code>を<code>tzdb</code>データベースと関連付けることができる.
<em onclick="obj=document.getElementById('openzoned_traits').style; obj.display=(obj.display=='none')?'block':'none';">
<a style="font-style: normal; cursor:pointer;">次のように定義される(クリックで展開).</a>
</em>
<div id="openzoned_traits" style="display:none;clear:both;"></p>
<div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="n">std</span> <span class="p">{</span> <span class="k">namespace</span> <span class="n">chrono</span> <span class="p">{</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="o">&gt;</span> <span class="k">struct</span> <span class="n">zoned_traits</span> <span class="p">{};</span>
<span class="k">template</span> <span class="o">&lt;&gt;</span>
<span class="k">struct</span> <span class="n">zoned_traits</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">time_zone</span><span class="o">*&gt;</span> <span class="p">{</span>
    <span class="k">static</span> <span class="k">const</span> <span class="n">time_zone</span><span class="o">*</span> <span class="n">default_zone</span><span class="p">();</span>
    <span class="k">static</span> <span class="k">const</span> <span class="n">time_zone</span><span class="o">*</span> <span class="nf">locate_zone</span><span class="p">(</span><span class="n">string_view</span> <span class="n">name</span><span class="p">);</span>
<span class="p">};</span>

<span class="p">}</span> <span class="p">}</span>
</pre></div>


</div>

<p><code>zoned_traits</code>によって, <code>zoned_time</code>のデフォルトコンストラクタの動作をカスタマイズすることができる.</p>
<ul>
<li><code>zoned_traits&lt;const time_zone*&gt;::default_zone();</code> は, <code>std::chrono::locate_zone("UTC")</code> を返す.</li>
<li><code>zoned_traits&lt;const time_zone*&gt;::locate_zone(string_view name);</code> は, <code>std::chrono::locate_zone(name)</code> を返す.</li>
</ul>
<p><code>zoned_time</code>は, <code>Duration</code>の精度で, <code>time_zone</code>と<code>time_point</code>の論理区切りを表す. <i>Strong equality</i><sup id="fnref3-1"><a class="footnote-ref" href="#fn-1">1</a></sup>を満たす.
<em onclick="obj=document.getElementById('openzoned_time').style; obj.display=(obj.display=='none')?'block':'none';">
<a style="font-style: normal; cursor:pointer;">次のように定義される(クリックで展開).</a>
</em>
<div id="openzoned_time" style="display:none;clear:both;"></p>
<div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">Duration</span><span class="p">,</span> <span class="k">class</span> <span class="nc">TimeZonePtr</span> <span class="o">=</span> <span class="k">const</span> <span class="n">time_zone</span><span class="o">*&gt;</span>
<span class="k">class</span> <span class="nc">zoned_time</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="k">using</span> <span class="n">duration</span> <span class="o">=</span> <span class="n">common_type_t</span><span class="o">&lt;</span><span class="n">Duration</span><span class="p">,</span> <span class="n">seconds</span><span class="o">&gt;</span><span class="p">;</span>

<span class="k">private</span><span class="o">:</span>
    <span class="n">TimeZonePtr</span>        <span class="n">zone_</span><span class="p">;</span>  <span class="c1">// exposition only</span>
    <span class="n">sys_time</span><span class="o">&lt;</span><span class="n">duration</span><span class="o">&gt;</span> <span class="n">tp_</span><span class="p">;</span>    <span class="c1">// exposition only</span>

<span class="k">public</span><span class="o">:</span>
    <span class="n">zoned_time</span><span class="p">();</span>
    <span class="n">zoned_time</span><span class="p">(</span><span class="k">const</span> <span class="n">zoned_time</span><span class="o">&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
    <span class="n">zoned_time</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">zoned_time</span><span class="o">&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>

             <span class="n">zoned_time</span><span class="p">(</span><span class="k">const</span> <span class="n">sys_time</span><span class="o">&lt;</span><span class="n">Duration</span><span class="o">&gt;&amp;</span> <span class="n">st</span><span class="p">);</span>
    <span class="k">explicit</span> <span class="nf">zoned_time</span><span class="p">(</span><span class="n">TimeZonePtr</span> <span class="n">z</span><span class="p">);</span>
    <span class="k">explicit</span> <span class="nf">zoned_time</span><span class="p">(</span><span class="n">string_view</span> <span class="n">name</span><span class="p">);</span>

    <span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">Duration2</span><span class="o">&gt;</span>
        <span class="n">zoned_time</span><span class="p">(</span><span class="k">const</span> <span class="n">zoned_time</span><span class="o">&lt;</span><span class="n">Duration2</span><span class="o">&gt;&amp;</span> <span class="n">zt</span><span class="p">)</span> <span class="k">noexcept</span><span class="p">;</span>

    <span class="n">zoned_time</span><span class="p">(</span><span class="n">TimeZonePtr</span> <span class="n">z</span><span class="p">,</span>    <span class="k">const</span> <span class="n">sys_time</span><span class="o">&lt;</span><span class="n">Duration</span><span class="o">&gt;&amp;</span> <span class="n">st</span><span class="p">);</span>
    <span class="n">zoned_time</span><span class="p">(</span><span class="n">string_view</span> <span class="n">name</span><span class="p">,</span> <span class="k">const</span> <span class="n">sys_time</span><span class="o">&lt;</span><span class="n">Duration</span><span class="o">&gt;&amp;</span> <span class="n">st</span><span class="p">);</span>

    <span class="n">zoned_time</span><span class="p">(</span><span class="n">TimeZonePtr</span> <span class="n">z</span><span class="p">,</span>    <span class="k">const</span> <span class="n">local_time</span><span class="o">&lt;</span><span class="n">Duration</span><span class="o">&gt;&amp;</span> <span class="n">tp</span><span class="p">);</span>
    <span class="n">zoned_time</span><span class="p">(</span><span class="n">string_view</span> <span class="n">name</span><span class="p">,</span> <span class="k">const</span> <span class="n">local_time</span><span class="o">&lt;</span><span class="n">Duration</span><span class="o">&gt;&amp;</span> <span class="n">tp</span><span class="p">);</span>
    <span class="n">zoned_time</span><span class="p">(</span><span class="n">TimeZonePtr</span> <span class="n">z</span><span class="p">,</span>    <span class="k">const</span> <span class="n">local_time</span><span class="o">&lt;</span><span class="n">Duration</span><span class="o">&gt;&amp;</span> <span class="n">tp</span><span class="p">,</span> <span class="n">choose</span> <span class="n">c</span><span class="p">);</span>
    <span class="n">zoned_time</span><span class="p">(</span><span class="n">string_view</span> <span class="n">name</span><span class="p">,</span> <span class="k">const</span> <span class="n">local_time</span><span class="o">&lt;</span><span class="n">Duration</span><span class="o">&gt;&amp;</span> <span class="n">tp</span><span class="p">,</span> <span class="n">choose</span> <span class="n">c</span><span class="p">);</span>

    <span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">Duration2</span><span class="p">,</span> <span class="k">class</span> <span class="nc">TimeZonePtr2</span><span class="o">&gt;</span>
        <span class="n">zoned_time</span><span class="p">(</span><span class="n">TimeZonePtr</span> <span class="n">z</span><span class="p">,</span> <span class="k">const</span> <span class="n">zoned_time</span><span class="o">&lt;</span><span class="n">Duration2</span><span class="p">,</span> <span class="n">TimeZonePtr2</span><span class="o">&gt;&amp;</span> <span class="n">zt</span><span class="p">);</span>
    <span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">Duration2</span><span class="p">,</span> <span class="k">class</span> <span class="nc">TimeZonePtr2</span><span class="o">&gt;</span>
        <span class="n">zoned_time</span><span class="p">(</span><span class="n">TimeZonePtr</span> <span class="n">z</span><span class="p">,</span> <span class="k">const</span> <span class="n">zoned_time</span><span class="o">&lt;</span><span class="n">Duration2</span><span class="p">,</span> <span class="n">TimeZonePtr2</span><span class="o">&gt;&amp;</span> <span class="n">zt</span><span class="p">,</span> <span class="n">choose</span><span class="p">);</span>

    <span class="n">zoned_time</span><span class="p">(</span><span class="n">string_view</span> <span class="n">name</span><span class="p">,</span> <span class="k">const</span> <span class="n">zoned_time</span><span class="o">&lt;</span><span class="n">Duration</span><span class="o">&gt;&amp;</span> <span class="n">zt</span><span class="p">);</span>
    <span class="n">zoned_time</span><span class="p">(</span><span class="n">string_view</span> <span class="n">name</span><span class="p">,</span> <span class="k">const</span> <span class="n">zoned_time</span><span class="o">&lt;</span><span class="n">Duration</span><span class="o">&gt;&amp;</span> <span class="n">zt</span><span class="p">,</span> <span class="n">choose</span><span class="p">);</span>

    <span class="n">zoned_time</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">sys_time</span><span class="o">&lt;</span><span class="n">Duration</span><span class="o">&gt;&amp;</span> <span class="n">st</span><span class="p">);</span>
    <span class="n">zoned_time</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">local_time</span><span class="o">&lt;</span><span class="n">Duration</span><span class="o">&gt;&amp;</span> <span class="n">ut</span><span class="p">);</span>

             <span class="k">operator</span> <span class="n">sys_time</span><span class="o">&lt;</span><span class="n">duration</span><span class="o">&gt;</span><span class="p">()</span>   <span class="k">const</span><span class="p">;</span>
    <span class="k">explicit</span> <span class="k">operator</span> <span class="n">local_time</span><span class="o">&lt;</span><span class="n">duration</span><span class="o">&gt;</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>

    <span class="n">TimeZonePtr</span>          <span class="nf">get_time_zone</span><span class="p">()</span>  <span class="k">const</span><span class="p">;</span>
    <span class="n">local_time</span><span class="o">&lt;</span><span class="n">duration</span><span class="o">&gt;</span> <span class="n">get_local_time</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
    <span class="n">sys_time</span><span class="o">&lt;</span><span class="n">duration</span><span class="o">&gt;</span>   <span class="n">get_sys_time</span><span class="p">()</span>   <span class="k">const</span><span class="p">;</span>
    <span class="n">sys_info</span>             <span class="nf">get_info</span><span class="p">()</span>       <span class="k">const</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>


</div>

<ul>
<li>invariant な<code>zoned_time&lt;Duration&gt;</code>は常に有効な<code>time_zone</code>を参照し,&nbsp;曖昧でない時間を表す.</li>
<li>デフォルコンストラクタは, <code>zone_</code>を<code>zoned_traits::default_zone()</code>で初期化し, <code>tp_</code>をデフォルト構築して<code>zoned_time</code>を構築する.</li>
<li>コピーコンストラクタは, 関連する<code>time_zone</code>を転送する. <code>Duration</code>が<code>noexcept</code>コピーコンストラクタである場合, <code>zoned_time&lt;Duration&gt;</code>は<code>noexcept</code>コピーコンストラクタである.</li>
<li><code>zoned_time(const sys_time&lt;Duration&gt;&amp; st)</code>: <code>zone_</code>を<code>zoned_traits::default_zone</code>で初期化し, <code>tp_</code>を<code>st</code>で初期化して<code>zoned_time</code>を構築する.</li>
<li><code>zoned_time(TimeZonePtr z)</code>: <code>std::move(z)</code>で<code>zone_</code>を初期化し, <code>zoned_time</code>を構築する. このとき, <code>z</code>は有効な<code>time_zone</code>を指していなければならない.</li>
<li><code>zoned_time(string_view name)</code>: <code>zoned_traits::locate_zone(name)</code>で<code>zone_</code>を初期化し, <code>tp_</code>をデフォルト構築して<code>zoned_time</code>を構築する.</li>
<li><code>zoned_time(const zoned_time&lt;Duration2, TimeZonePtr&gt;&amp; y) noexcept</code>: <code>x == y</code>となる<code>zoned_time</code>, <code>x</code>を構築する.</li>
<li><code>zoned_time(TimeZonePtr z, const sys_time&lt;Duration&gt;&amp; st)</code>: <code>zone_</code>を<code>std::move(z)</code>で初期化し, <code>tp_</code>を<code>st</code>で初期化して<code>zoned_time</code>を構築する. このとき, <code>z</code>は有効な<code>time_zone</code>を指していなければならない.</li>
<li><code>zoned_time(string_view name, const sys_time&lt;Duration&gt;&amp; st)</code>: <code>{zoned_traits&lt;TimeZonePtr&gt;::locate_zone(name), st}</code>と同等の構築を行う.</li>
<li><code>zoned_time(TimeZonePtr z, const local_time&lt;Duration&gt;&amp; tp)</code>: <code>zone_</code>を<code>std::move(z)</code>で初期化し, <code>tp_</code>を<code>zone_-&gt;to_sys(t)</code>で初期化して<code>zoned_time</code>を構築する. このとき, <code>z</code>は有効な<code>time_zone</code>を指していなければならない.</li>
<li><code>zoned_time(string_view name, const local_time&lt;Duration&gt;&amp; tp)</code>: <code>{zoned_traits&lt;TimeZonePtr&gt;::locate_zone(name), tp}</code>と同等の構築を行う.</li>
<li><code>zoned_time(TimeZonePtr z, const local_time&lt;Duration&gt;&amp; tp, choose c)</code>:  <code>zoned_</code>を<code>std::moev(z)</code>で初期化し, <code>tp</code>を<code>zone_-&gt;to_sys(t, c)</code>で初期化して<code>zoned_time</code>を構築する. このとき, <code>z</code>は有効な<code>time_zone</code>を指していなければならない.</li>
<li><code>zoned_time(string_view name, const local_time&lt;Duration&gt;&amp; tp, choose c)</code>: <code>{zoned_traits&lt;TimeZonePtr&gt;::locate_zone(name), tp, c}</code>と同等の構築を行う.</li>
<li><code>zoned_time(TimeZonePtr z, const zoned_time&lt;Duration2, TimeZonePtr2&gt;&amp; y)</code>: <code>zone_</code>を<code>std::move(z)</code>で初期化し, <code>tp_</code>を<code>z.tp_</code>で初期化して<code>zoned_time</code>を構築する. このとき, <code>z</code>は有効な<code>time_zone</code>を指していなければならない.</li>
<li><code>zoned_time(TimeZonePtr z, const zoned_time&lt;Duration2, TimeZonePtr2&gt;&amp; y, choose)</code>: <code>{z, y}</code>と同等の構築を行う. このとき, <code>z</code>は有効な<code>time_zone</code>を指していなければならない. <code>choose</code>パラメータを渡すことができるが,&nbsp;これによって挙動が変わることはない.</li>
<li><code>zoned_time(string_view name, const zoned_time&lt;Duration&gt;&amp; y)</code>: <code>{zoned_traits&lt;TimeZonePtr&gt;::locate_zone(name), y}</code>と同等の構築を行う.</li>
<li><code>zoned_time(string_view name, const zoned_time&lt;Duration&gt;&amp; y, choose c)</code>: <code>{locate_zone(name), y, c}</code>と同等の構築を行う. <code>choose</code>パラメータを渡すことができるが,&nbsp;これによって挙動が変わることはない.</li>
<li><code>operator=(const local_time&lt;Duration&gt;&amp; lt)</code>: 代入後, <code>get_local_time() == lt</code>となるよう代入し<code>*this</code>を返す. この代入は, <code>get_time_zone</code>の戻り値には影響しない.</li>
<li><code>operator sys_time&lt;duration&gt;() const</code>: <code>get_sys_time()</code>を返す.</li>
<li><code>operator local_time&lt;duration&gt;() const</code>: <code>get_local_time()</code> を返す.</li>
<li><code>get_time_zone</code>メンバ関数によって, <code>zone_</code>のポインタを取得できる.</li>
<li><code>get_local_time</code>メンバ関数によって, 構築時に設定されたタイムゾーンでの<code>local_time</code>オブジェクトを取得できる(<code>retunr zone_-&gt;to_local(tp_);</code>).</li>
<li><code>get_sys_time</code>メンバ関数によって, 構築時に設定されたタイムゾーンでの<code>sys_time</code>オブジェクトを取得できる(<code>return tp_;</code>).</li>
<li><code>get_info</code>メンバ関数によって, 構築時に設定されたタイムゾーンでの<code>sys_info</code>オブジェクトを取得できる(<code>return zone_-&gt;get_info(tp_);</code>).</li>
</ul>
<p>同ライブラリを利用して, 例えば次のように, ある日時の東京の時間帯を得ることができる<sup id="fnref-5"><a class="footnote-ref" href="#fn-5">5</a></sup>.</p>
<div class="highlight"><pre><span></span><span class="k">auto</span> <span class="n">tp1</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">sys_days</span><span class="p">{</span><span class="mi">2016</span><span class="n">y</span><span class="o">/</span><span class="n">May</span><span class="o">/</span><span class="mi">29</span><span class="n">d</span><span class="p">}</span> <span class="o">+</span> <span class="mi">7</span><span class="n">h</span> <span class="o">+</span> <span class="mi">30</span><span class="n">min</span> <span class="o">+</span> <span class="mi">6</span><span class="n">s</span> <span class="o">+</span> <span class="mi">153</span><span class="n">ms</span><span class="p">;</span> <span class="c1">// 2016-05-29 07:30:06.153 UTC</span>
<span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">zoned_time</span> <span class="n">zt1</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;Asia/Tokyo&quot;</span><span class="p">,</span> <span class="n">tp1</span><span class="p">};</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">zt1</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span> <span class="c1">// 2016-05-29 16:30:06.153 JST</span>

<span class="k">auto</span> <span class="n">tp2</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">local_days</span><span class="p">{</span><span class="mi">2016</span><span class="n">y</span><span class="o">/</span><span class="n">May</span><span class="o">/</span><span class="mi">29</span><span class="n">d</span><span class="p">}</span> <span class="o">+</span> <span class="mi">7</span><span class="n">h</span> <span class="o">+</span> <span class="mi">30</span><span class="n">min</span> <span class="o">+</span> <span class="mi">6</span><span class="n">s</span> <span class="o">+</span> <span class="mi">153</span><span class="n">ms</span><span class="p">;</span> <span class="c1">// 2016-05-29 07:30:06.153 JTC</span>
<span class="k">auto</span> <span class="n">zt2</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">zoned_time</span><span class="p">{</span><span class="s">&quot;Asia/Tokyo&quot;</span><span class="p">,</span> <span class="n">tp2</span><span class="p">};</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">zt</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span> <span class="c1">// 2016-05-29 07:30:06.153 JST</span>
</pre></div>


<p><code>leap</code>は, タイムゾーンデータベースの初期化時に構築され, タイムゾーンデータベースに格納されるクラスであり, 主に閏秒を扱うクラスである. 同クラスは, <i>Strong ordering</i><sup id="fnref4-1"><a class="footnote-ref" href="#fn-1">1</a></sup>を満たす.
<em onclick="obj=document.getElementById('openclassleap').style; obj.display=(obj.display=='none')?'block':'none';">
<a style="font-style: normal; cursor:pointer;">次のように定義される(クリックで展開).</a>
</em>
<div id="openclassleap" style="display:none;clear:both;"></p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">leap</span>
<span class="p">{</span>
    <span class="n">sys_seconds</span> <span class="n">date_</span><span class="p">;</span>  <span class="c1">// exposition only</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">leap</span><span class="p">(</span><span class="k">const</span> <span class="n">leap</span><span class="o">&amp;</span><span class="p">)</span>            <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
    <span class="n">leap</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">leap</span><span class="o">&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>

    <span class="c1">// Undocumented constructors</span>
    <span class="n">sys_seconds</span> <span class="nf">date</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>


</div>

<ul>
<li><code>date</code>メンバ関数によって, <code>date_</code>を取得できる. <code>date_</code>には閏秒挿入の日付が格納されている.</li>
<li>閏秒挿入の全ての日付を<code>for (auto&amp; l : get_tzdb().leaps) std::cout &lt;&lt; l.date() &lt;&lt; '\n';</code>で確認できる.</li>
</ul>
<p>またタイムゾーンデータベースの構築時に作成される, <code>time_zone</code>の代替名を表現する<code>link</code>というクラスも提供される.</p>
<h3>Clock</h3>
<p>新たに <code>utc_clock</code>, <code>tai_clock</code>, <code>gps_clock</code>, <code>file_clock</code> の 4 つのクロック, 
また, その<code>time_point</code>型のエイリアス(<code>utc_time</code>, <code>utc_seconds</code>, <code>tai_time</code>, <code>tai_seconds</code>, <code>gps_time</code>, <code>gps_seconds</code>)&nbsp;が提供される.</p>
<ul>
<li><code>utc_clock</code> は, 協定世界時(<span class="caps">UTC</span>)を表現するクロックであり, 1970 年 1 月 1 日木曜日午後 00:00:00 分からの時間を測定する. これには,&nbsp;閏秒が含まれる.</li>
<li><code>tai_clock</code>は, 国際原始時計(<span class="caps">TAI</span>)を表現するクロックであり, 1958 年 1 月 1 日 00:00:00 からの時間を測定し, この日の <span class="caps">UTC</span>(1957-12-31 23:59:50 <span class="caps">UTC</span>)よりも 10 秒前にオフセットされている. これには, 閏秒が含まれない<sup id="fnref-9"><a class="footnote-ref" href="#fn-9">9</a></sup>.</li>
<li><code>gps_clock</code>は <span class="caps">GPS</span> 時刻を表現するクロックであり, <span class="caps">UTC</span> 1980 年 1 月 6 日 00:00:00 からの時間を測定する. 閏秒は含まれない<sup id="fnref-10"><a class="footnote-ref" href="#fn-10">10</a></sup>.</li>
<li><code>file_clock</code>は, C++20 で追加されたエイリアス, <code>using file_time_type = std::chrono::time_point&lt;std::chrono::file_clock&gt;;</code>で利用されるファイルクロックである<sup id="fnref-11"><a class="footnote-ref" href="#fn-11">11</a></sup>.</li>
</ul>
<h3>試用</h3>
<p>同ライブラリを利用した任意月のカレンダーを出力するプログラムは, <a href="http://d.hatena.ne.jp/yohhoy/20180322/p1">既にあった</a>のだが, 特別何か別のものは思いつかないので,
とりあえず,&nbsp;任意年の全ての月のカレンダーを出力するプログラムを書いて試用.</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;array&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;chrono&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iomanip&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;utility&gt;</span><span class="cp"></span>

<span class="k">namespace</span> <span class="n">ns</span> <span class="p">{</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="n">class</span><span class="o">&gt;</span> <span class="k">struct</span> <span class="n">weeks_init</span><span class="p">;</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="p">...</span> <span class="n">s</span><span class="o">&gt;</span>
<span class="k">struct</span> <span class="n">weeks_init</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">index_sequence</span><span class="o">&lt;</span><span class="n">s</span><span class="p">...</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
    <span class="k">constexpr</span> <span class="n">weeks_init</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
    <span class="k">constexpr</span> <span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">weekday</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">...(</span><span class="n">s</span><span class="p">)</span><span class="o">&gt;</span> <span class="k">operator</span><span class="p">()()</span> <span class="k">const</span> <span class="k">noexcept</span> <span class="p">{</span> <span class="k">return</span> <span class="p">{{</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">weekday</span><span class="p">{</span><span class="n">s</span><span class="p">}...</span> <span class="p">}};</span> <span class="p">}</span>
<span class="p">};</span>
<span class="k">constexpr</span> <span class="k">auto</span> <span class="n">weeks</span> <span class="o">=</span> <span class="n">weeks_init</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">make_index_sequence</span><span class="o">&lt;</span><span class="mi">7</span><span class="o">&gt;&gt;</span><span class="p">()();</span>

<span class="kr">inline</span> <span class="kt">void</span> <span class="nf">print_weeks</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">os</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">namespace</span> <span class="n">sc</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">copy</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">begin</span><span class="p">(</span><span class="n">weeks</span><span class="p">),</span> <span class="n">std</span><span class="o">::</span><span class="n">end</span><span class="p">(</span><span class="n">weeks</span><span class="p">),</span> <span class="n">std</span><span class="o">::</span><span class="n">ostream_iterator</span><span class="o">&lt;</span><span class="n">sc</span><span class="o">::</span><span class="n">weekday</span><span class="o">&gt;</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="s">&quot;  &quot;</span><span class="p">));</span>
    <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">}</span> <span class="c1">// namespace ns</span>

<span class="k">struct</span> <span class="n">print_calendar_year</span> <span class="p">{</span>
    <span class="k">explicit</span> <span class="k">constexpr</span> <span class="n">print_calendar_year</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">year</span> <span class="n">y</span><span class="p">)</span> <span class="k">noexcept</span>
        <span class="o">:</span> <span class="n">y_</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="p">{}</span>

    <span class="k">friend</span> <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">os</span><span class="p">,</span> <span class="k">const</span> <span class="n">print_calendar_year</span><span class="o">&amp;</span> <span class="n">this_</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono_literals</span><span class="p">;</span>
        <span class="k">namespace</span> <span class="n">sc</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="p">;</span>
        <span class="k">constexpr</span> <span class="kt">int</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1u</span><span class="p">,</span> <span class="n">uweek</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="o">&gt;</span><span class="p">(</span><span class="n">sc</span><span class="o">::</span><span class="n">weekday</span><span class="p">{</span><span class="n">sc</span><span class="o">::</span><span class="n">sys_days</span><span class="p">{</span><span class="n">this_</span><span class="p">.</span><span class="n">y_</span><span class="o">/</span><span class="n">sc</span><span class="o">::</span><span class="n">January</span><span class="o">/</span><span class="mi">1</span><span class="n">d</span><span class="p">}});</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">12u</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">auto</span> <span class="n">lastday</span> <span class="o">=</span> <span class="p">(</span><span class="n">this_</span><span class="p">.</span><span class="n">y_</span><span class="o">/</span><span class="n">sc</span><span class="o">::</span><span class="n">month</span><span class="p">{</span><span class="n">i</span><span class="p">}</span><span class="o">/</span><span class="n">sc</span><span class="o">::</span><span class="n">last</span><span class="p">).</span><span class="n">day</span><span class="p">();</span>
            <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">setw</span><span class="p">(</span><span class="n">ns</span><span class="o">::</span><span class="n">weeks</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">*</span> <span class="n">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">sc</span><span class="o">::</span><span class="n">month</span><span class="p">{</span><span class="n">i</span><span class="p">}</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
            <span class="n">ns</span><span class="o">::</span><span class="n">print_weeks</span><span class="p">(</span><span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">setw</span><span class="p">(</span><span class="n">width</span><span class="p">));</span>

            <span class="kt">unsigned</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">uweek</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">setw</span><span class="p">(</span><span class="n">width</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">sc</span><span class="o">::</span><span class="n">day</span> <span class="n">d</span><span class="p">{</span><span class="mi">1</span><span class="p">};</span> <span class="n">d</span> <span class="o">&lt;=</span> <span class="n">lastday</span><span class="p">;</span> <span class="o">++</span><span class="n">d</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">setw</span><span class="p">(</span><span class="n">width</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="o">&gt;</span><span class="p">(</span><span class="n">d</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="n">k</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                    <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
            <span class="n">uweek</span> <span class="o">=</span> <span class="n">k</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">os</span><span class="p">;</span>
    <span class="p">}</span>
<span class="k">private</span><span class="o">:</span>
    <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">year</span> <span class="n">y_</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">print_calendar_year</span><span class="p">{</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">year</span><span class="p">{</span><span class="mi">2000</span><span class="p">}}</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p><a href="https://wandbox.org/permlink/qdkXXRJFNGPTdDg2">実行結果</a>. <br></p>
<p>タイムゾーンに関するサンプルは, <a href="https://howardhinnant.github.io/date/tz.html">元の実装のドキュメント</a>で多く取り上げられている. フライトタイムの計算や, <span class="caps">IANA</span>&nbsp;タイムゾーンデータベースを利用しないカスタムタイムゾーンを作成する例などが掲示されている.</p>
<h3>感想</h3>
<ul>
<li>とてもよく作り込まれていて,&nbsp;使いやすそうに感じる. </li>
<li>C++ にこのような高レベル <span class="caps">API</span> が導入されるのは,&nbsp;少し新鮮.</li>
</ul>
<div class="footnote">
<hr>
<ol>
<li id="fn-1">
<p>この一つ前の <span class="caps">ISO</span> C++ 委員会による国際会議で C++20 に追加された <a href="http://open-std.org/JTC1/SC22/WG21/docs/papers/2017/p0515r2.pdf">P0515 Consistent comparison</a> で挙げられている comparison category types での呼称を用いている. 参照: <a href="https://roki.hateblo.jp/entry/2017/11/27/Consistent/three-way_comparison">Consistent/three-way comparison</a>&#160;<a class="footnote-backref" href="#fnref-1" title="Jump back to footnote 1 in the text">&#8617;</a><a class="footnote-backref" href="#fnref2-1" title="Jump back to footnote 1 in the text">&#8617;</a><a class="footnote-backref" href="#fnref3-1" title="Jump back to footnote 1 in the text">&#8617;</a><a class="footnote-backref" href="#fnref4-1" title="Jump back to footnote 1 in the text">&#8617;</a><a class="footnote-backref" href="#fnref5-1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn-2">
<p>タイムゾーンライブラリの型とその関係性を示した<a href="https://howardhinnant.github.io/date/tz_types.jpeg">図</a>を, 作者のドキュメントページから見ることができる.&#160;<a class="footnote-backref" href="#fnref-2" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
<li id="fn-3">
<p><a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones">List of tz database time zones</a>&#160;<a class="footnote-backref" href="#fnref-3" title="Jump back to footnote 3 in the text">&#8617;</a><a class="footnote-backref" href="#fnref2-3" title="Jump back to footnote 3 in the text">&#8617;</a></p>
</li>
<li id="fn-4">
<p><a href="https://github.com/HowardHinnant/date">元の実装</a>を見ると, 現在地のタイムゾーン取得においては, <a href="https://github.com/HowardHinnant/date/blob/38c5ca38bb73b292b72e088c31595add564d31f6/src/tz.cpp#L321-L372">Linux および Mac では特定ファイル(/usr/share/zoneinfo, /usr/share/zoneinfo/uclibc) を読み込み</a>, <a href="https://github.com/HowardHinnant/date/blob/38c5ca38bb73b292b72e088c31595add564d31f6/src/tz.cpp#L3615-L3631">Windows ではレジストリ値を読み込んでいる</a>. レジストリ値から取得されたネイティブな現在のタイムゾーン名が標準のものと一致する保証はなく, 特に Windows の場合, 得られる名前は必ず標準と異なるものであるため, 標準の名前と関連づけるマッピングが行われる. 元の実装では, Windows の場合ではタイムゾーンデータベースの取得の際に, <a href="http://unicode.org/repos/cldr/trunk/common/supplemental/windowsZones.xml">xml ファイル</a> を<a href="https://github.com/HowardHinnant/date/blob/38c5ca38bb73b292b72e088c31595add564d31f6/src/tz.cpp#L3263-L3271">取得している</a>.&#160;<a class="footnote-backref" href="#fnref-4" title="Jump back to footnote 4 in the text">&#8617;</a></p>
</li>
<li id="fn-5">
<p><a href="https://github.com/HowardHinnant/date">元の実装</a>を見ると, <span class="caps">OS</span> のタイムゾーンデータベースを利用せず, リモート <span class="caps">API</span> があるときは <a href="https://github.com/HowardHinnant/date/blob/38c5ca38bb73b292b72e088c31595add564d31f6/src/tz.cpp#L3243-L3273"><span class="caps">OS</span> 依存またはサードパーティ製のライブラリを利用してデータを取得</a>し, そうでないとき <span class="caps">OS</span> のタイムゾーンデータベースを利用する. <a href="https://github.com/HowardHinnant/date">元の実装</a>で <span class="caps">OS</span> のタイムゾーンデータベースを試用する際には, <code>DUSE_OS_TZDB=1</code>をセットしてビルドする. Windows 環境がないので筆者にはわからないが, <a href="https://github.com/HowardHinnant/date/blob/e7e1482087f58913b80a20b04d5c58d9d6d90155/CMakeLists.txt#L51">Windows では <span class="caps">OS</span> のタイムゾーンデータベースを利用できないようだ</a>.&#160;<a class="footnote-backref" href="#fnref-5" title="Jump back to footnote 5 in the text">&#8617;</a><a class="footnote-backref" href="#fnref2-5" title="Jump back to footnote 5 in the text">&#8617;</a></p>
</li>
<li id="fn-6">
<p>サマータイムの開始と終了で, 存在しないローカル時間(<code>nonexistent_local_time</code>)と重複するローカル時間(<code>ambiguous_local_time</code>)という概念が生じる.&#160;<a class="footnote-backref" href="#fnref-6" title="Jump back to footnote 6 in the text">&#8617;</a><a class="footnote-backref" href="#fnref2-6" title="Jump back to footnote 6 in the text">&#8617;</a><a class="footnote-backref" href="#fnref3-6" title="Jump back to footnote 6 in the text">&#8617;</a><a class="footnote-backref" href="#fnref4-6" title="Jump back to footnote 6 in the text">&#8617;</a><a class="footnote-backref" href="#fnref5-6" title="Jump back to footnote 6 in the text">&#8617;</a></p>
</li>
<li id="fn-7">
<p>2016-11-06 01:30:00 <span class="caps">EDT</span> は, 2016-11-06 05:30:00 <span class="caps">UTC</span> と 2016-11-06 06:30:00 <span class="caps">UTC</span>
 になりうる. <code>try { auto zt = zoned_time{"America/New_York", local_days{Sunday[1]/November/2016} + 1h + 30min}; } catch (const ambiguous_local_time&amp;) { }</code>&#160;<a class="footnote-backref" href="#fnref-7" title="Jump back to footnote 7 in the text">&#8617;</a></p>
</li>
<li id="fn-8">
<p>2016-03-13 02:30:00 <span class="caps">EDT</span> は, 2016-03-13 02:00:00 <span class="caps">EST</span> と 2016-03-13 03:00:00 <span class="caps">EDT</span> の間にあるため存在しない. どちらも, 2016-03-13 07:00:00 <span class="caps">UTC</span> と等価である. <code>try { auto zt = zoned_time{"America/New_York", local_days{Sunday[2]/March/2016} + 2h + 30min}; } catch (const noexistent_local_time&amp;) {}</code>&#160;<a class="footnote-backref" href="#fnref-8" title="Jump back to footnote 8 in the text">&#8617;</a></p>
</li>
<li id="fn-9">
<p>閏秒が <span class="caps">UTC</span> に挿入される度に, <span class="caps">UTC</span> は <span class="caps">TAI</span> の 1 秒遅れとなる. 1961 年発祥の旧 <span class="caps">UTC</span>, 1972 年の特別調整, 1972 年から 2017 年 1 月まで行われた27 回の閏秒調整の過程を踏み, <span class="caps">UTC</span> は現在 <span class="caps">TAI</span> に対して 37 秒遅れている. 参考: <a href="http://jjy.nict.go.jp/mission/page1.html">http://jjy.nict.go.jp/mission/page1.html</a>&#160;<a class="footnote-backref" href="#fnref-9" title="Jump back to footnote 9 in the text">&#8617;</a></p>
</li>
<li id="fn-10">
<p><code>tai_clock</code>同様, <span class="caps">UTC</span> に閏秒が挿入されるたびに <span class="caps">UTC</span> の 1 秒後を表現することとなる. 2017 年時点で, <span class="caps">UTC</span> は <span class="caps">GPS</span> の 18 秒前 にある. 余談: <a href="https://nyanchew.com/jp/gps%E3%81%AF%E3%81%A9%E3%81%AE%E3%82%88%E3%81%86%E3%81%AB%E3%81%97%E3%81%A6%E3%81%86%E3%82%8B%E3%81%86%E7%A7%92%E3%82%92%E6%8C%BF%E5%85%A5%E3%81%99%E3%82%8B%E3%81%8B"><span class="caps">GPS</span> が <span class="caps">UTC</span> との差分を計算する方法に関して</a>.&#160;<a class="footnote-backref" href="#fnref-10" title="Jump back to footnote 10 in the text">&#8617;</a></p>
</li>
<li id="fn-11">
<p><code>file_time_type</code>は C++17 時点で既にエイリアスとして追加されているが, <code>using file_time_type = std::chrono::time_point&lt;/*trivial-clock*/&gt;;</code>と記されており, 具体的なクロック型は明記されていなかった.&#160;<a class="footnote-backref" href="#fnref-11" title="Jump back to footnote 11 in the text">&#8617;</a></p>
</li>
<li id="fn-12">
<p><a href="https://twitter.com/yohhoy/status/985830560013500416">yohhoy</a> さんに<code>last</code>の属する名前空間に関する追加情報を頂いた. ありがとうございます.&#160;<a class="footnote-backref" href="#fnref-12" title="Jump back to footnote 12 in the text">&#8617;</a></p>
</li>
</ol>
</div>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (true) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js','color.js','enclose.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: false," +
        "    messageStyle: 'None'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'black ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>
      </div>
<!-- /.entry-content -->
      <footer class="post-info text-muted">
        <button type="button" class="btn btn-default">          
          <a href="../../../../../category/cpp.html"><div class="fa fa-lg fa-folder-open"></div> C++</a>
        </button>
        <button type="button" class="btn btn-default">
          <a href="../../../../../tag/cpp.html"><div class="fa fa-lg fa-tag"></div> C++</a>
        </button>
      </footer>
      <!-- /.post-info -->
    <!-- Comment BEGIN -->
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'roki-log';
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <!-- Comment END -->
    </section>
    </div>
<footer class="footer">
      <div class="container">
          <p class="footer-text">&copy; <a href="../../../../..">roki.log</a> powered by 
          <a href="https://getpelican.com/">pelican</a> and 
          <a href="https://github.com/falgon/nikhil-theme">nikhil-theme (forked)</a><br>
              <small>  <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.ja"><img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by-nc-nd/4.0/80x15.png" /></a>
    Content
  licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.ja">Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License</a>, except where indicated otherwise.
</small>
            </p>
   </div>
</footer>    <script src="../../../../../theme/js/jquery.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-116653080-1', 'auto');
      ga('send', 'pageview');
       $('#myModal').modal({show: true});

    </script>
  </body>
</html>